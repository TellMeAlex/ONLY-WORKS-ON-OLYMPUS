{
  "version": 3,
  "sources": ["../src/config/loader.ts", "../src/config/schema.ts", "../src/config/scaffolder.ts", "../src/config/wizard.ts", "../src/config/prompts.ts", "../src/config/validator.ts", "../src/config/translator.ts", "../src/plugin/wrapper.ts", "../src/agents/routing.ts", "../src/agents/meta-agent.ts", "../src/agents/logger.ts", "../src/agents/registry.ts", "../src/agents/definitions/atenea.ts", "../src/agents/definitions/hermes.ts", "../src/agents/definitions/hades.ts", "../src/skills/loader.ts", "../src/analytics/storage.ts", "../src/index.ts"],
  "sourcesContent": ["import * as fs from \"fs\";\nimport * as path from \"path\";\nimport { parse } from \"jsonc-parser\";\nimport { OlimpusConfigSchema, type OlimpusConfig } from \"./schema.js\";\nimport { scaffoldOlimpusConfig } from \"./scaffolder.js\";\nimport { validateOlimpusConfig, formatErrors, formatWarnings } from \"./validator.js\";\n\n/**\n * Options for loading Olimpus configuration\n */\nexport interface LoadOlimpusConfigOptions {\n  /**\n   * Whether to perform semantic validation (circular dependencies, agent references, regex performance)\n   * @default true\n   */\n  validate?: boolean;\n  /**\n   * Whether to check circular dependencies in meta-agent delegation chains\n   * @default true\n   */\n  checkCircularDependencies?: boolean;\n  /**\n   * Whether to validate agent references against builtin agents\n   * @default true\n   */\n  checkAgentReferences?: boolean;\n  /**\n   * Whether to analyze regex patterns for performance issues (generates warnings only)\n   * @default true\n   */\n  checkRegexPerformance?: boolean;\n}\n\n/**\n * Load olimpus.jsonc from project directory and optional user config directory.\n * Search order: project dir first (overrides user config dir if both exist).\n * Returns parsed and validated config with merged defaults.\n *\n * Wizard mode behavior:\n * - By default, uses interactive wizard when no config exists\n * - Set OLIMPUS_SKIP_WIZARD=1 environment variable to skip wizard and use silent scaffolding\n *\n * @param projectDir - Path to the project directory containing olimpus.jsonc\n  * @param options - Optional configuration for loading and validation\n  * @returns Parsed and validated Olimpus configuration\n  * @throws Error if config is invalid according to schema or semantic validation\n  */\nexport async function loadOlimpusConfig(\n  projectDir: string,\n  options?: LoadOlimpusConfigOptions,\n): Promise<OlimpusConfig> {\n  const homeDir = process.env.HOME ?? \".\";\n  const userConfigPath = path.join(\n    homeDir,\n    \".config\",\n    \"opencode\",\n    \"olimpus.jsonc\",\n  );\n  const projectConfigPath = path.join(projectDir, \"olimpus.jsonc\");\n\n  let configData: Record<string, unknown> = {};\n\n  if (fs.existsSync(userConfigPath)) {\n    const content = fs.readFileSync(userConfigPath, \"utf-8\");\n    const userConfig = parseJsonc(content, userConfigPath);\n    if (userConfig) {\n      configData = deepMerge(configData, userConfig as Record<string, unknown>);\n    }\n  }\n\n  if (fs.existsSync(projectConfigPath)) {\n    const content = fs.readFileSync(projectConfigPath, \"utf-8\");\n    const projectConfig = parseJsonc(content, projectConfigPath);\n    if (projectConfig) {\n      configData = deepMerge(\n        configData,\n        projectConfig as Record<string, unknown>,\n      );\n    }\n  }\n\n  // If no config exists at either location, try to scaffold\n  const userConfigExists = fs.existsSync(userConfigPath);\n  const projectConfigExists = fs.existsSync(projectConfigPath);\n\n  if (!userConfigExists && !projectConfigExists) {\n    // Detect wizard mode: use wizard unless OLIMPUS_SKIP_WIZARD is set\n    const skipWizard =\n      process.env.OLIMPUS_SKIP_WIZARD === \"1\" ||\n      process.env.OLIMPUS_SKIP_WIZARD === \"true\";\n\n    const scaffoldResult = await scaffoldOlimpusConfig({\n      projectConfigExists: false,\n      userConfigExists: false,\n      useWizard: !skipWizard,\n    });\n\n    if (scaffoldResult && scaffoldResult.created) {\n      // Re-read the scaffolded config\n      const content = fs.readFileSync(scaffoldResult.path, \"utf-8\");\n      const scaffoldedConfig = parseJsonc(content, scaffoldResult.path);\n      if (scaffoldedConfig) {\n        configData = deepMerge(\n          configData,\n          scaffoldedConfig as Record<string, unknown>,\n        );\n      }\n    }\n    // If scaffolding failed or was skipped, configData remains {} (default empty config)\n  }\n\n  const result = OlimpusConfigSchema.safeParse(configData);\n  if (!result.success) {\n    const errors = result.error.issues\n      .map((issue) => `  ${issue.path.join(\".\")} - ${issue.message}`)\n      .join(\"\\n\");\n    throw new Error(`Invalid olimpus config:\\n${errors}`);\n  }\n\n  // Optional semantic validation for early error detection\n  const shouldValidate = options?.validate ?? true;\n  if (shouldValidate) {\n    const validationResult = validateOlimpusConfig(result.data, {\n      checkCircularDependencies: options?.checkCircularDependencies ?? true,\n      checkAgentReferences: options?.checkAgentReferences ?? true,\n      checkRegexPerformance: options?.checkRegexPerformance ?? true,\n    });\n\n    // Throw if there are validation errors\n    if (!validationResult.valid) {\n      const errorMessages = formatErrors(validationResult).join(\"\\n\");\n      const warningMessages = formatWarnings(validationResult).join(\"\\n\");\n      const message = `Configuration validation failed:\\n${errorMessages}${\n        warningMessages ? `\\n\\nWarnings:\\n${warningMessages}` : \"\"\n      }`;\n      throw new Error(message);\n    }\n\n    // Log warnings if any (warnings don't affect validity)\n    if (validationResult.warnings.length > 0) {\n      const warningMessages = formatWarnings(validationResult).join(\"\\n\");\n      // Note: In production code, consider using a proper logger\n      // For now, warnings are silently ignored to avoid breaking changes\n      // but available for callers to check via the returned config if needed\n    }\n  }\n\n  return result.data;\n}\n\n/**\n * Parse JSONC string and return parsed object or throw error.\n */\nfunction parseJsonc(content: string, filePath: string): unknown {\n  const errors: Array<{ error: number; offset: number; length: number }> = [];\n  const parsed = parse(content, errors, { allowTrailingComma: true });\n\n  if (errors.length > 0) {\n    const errorMessages = errors\n      .map((err) => {\n        const line = content.substring(0, err.offset).split(\"\\n\").length;\n        return `  Offset ${err.offset} (line ${line}): error code ${err.error}`;\n      })\n      .join(\"\\n\");\n    throw new Error(`JSONC parse error in ${filePath}:\\n${errorMessages}`);\n  }\n\n  return parsed;\n}\n\n/**\n * Deep merge two objects. Properties from source override target.\n * Arrays are replaced entirely (not merged).\n */\nfunction deepMerge(\n  target: Record<string, unknown>,\n  source: Record<string, unknown>,\n): Record<string, unknown> {\n  const result = { ...target };\n\n  for (const [key, sourceValue] of Object.entries(source)) {\n    const targetValue = result[key];\n\n    if (isPlainObject(targetValue) && isPlainObject(sourceValue)) {\n      result[key] = deepMerge(targetValue, sourceValue);\n    } else {\n      result[key] = sourceValue;\n    }\n  }\n\n  return result;\n}\n\n/**\n * Check if value is a plain object (not array, null, etc.)\n */\nfunction isPlainObject(value: unknown): value is Record<string, unknown> {\n  return typeof value === \"object\" && value !== null && !Array.isArray(value);\n}\n", "import { z } from \"zod\";\n\n/**\n * Builtin agent names that can be delegation targets\n */\nconst BUILTIN_AGENT_NAMES = [\n  \"sisyphus\",\n  \"hephaestus\",\n  \"oracle\",\n  \"librarian\",\n  \"explore\",\n  \"multimodal-looker\",\n  \"metis\",\n  \"momus\",\n  \"atlas\",\n  \"prometheus\",\n] as const;\n\n/**\n * Matcher Schemas - Discriminated Union\n */\n\nexport const KeywordMatcherSchema = z.object({\n  type: z.literal(\"keyword\"),\n  keywords: z.array(z.string()).min(1),\n  mode: z.enum([\"any\", \"all\"]),\n});\n\nexport const ComplexityMatcherSchema = z.object({\n  type: z.literal(\"complexity\"),\n  threshold: z.enum([\"low\", \"medium\", \"high\"]),\n});\n\nexport const RegexMatcherSchema = z.object({\n  type: z.literal(\"regex\"),\n  pattern: z.string().min(1),\n  flags: z.string().optional(),\n});\n\nexport const ProjectContextMatcherSchema = z.object({\n  type: z.literal(\"project_context\"),\n  has_files: z.array(z.string()).optional(),\n  has_deps: z.array(z.string()).optional(),\n});\n\nexport const AlwaysMatcherSchema = z.object({\n  type: z.literal(\"always\"),\n});\n\nexport const MatcherSchema = z.discriminatedUnion(\"type\", [\n  KeywordMatcherSchema,\n  ComplexityMatcherSchema,\n  RegexMatcherSchema,\n  ProjectContextMatcherSchema,\n  AlwaysMatcherSchema,\n]);\n\n/**\n * Routing Rule Schema\n */\n\nexport const RoutingRuleSchema = z.object({\n  matcher: MatcherSchema,\n  target_agent: z.string(),\n  config_overrides: z\n    .object({\n      model: z.string().optional(),\n      temperature: z.number().optional(),\n      prompt: z.string().optional(),\n      variant: z.string().optional(),\n    })\n    .optional(),\n});\n\n/**\n * Meta-Agent Definition Schema\n */\n\nexport const MetaAgentSchema = z.object({\n  base_model: z.string(),\n  delegates_to: z.array(z.string()).min(1),\n  routing_rules: z.array(RoutingRuleSchema).min(1),\n  prompt_template: z.string().optional(),\n  temperature: z.number().optional(),\n});\n\n/**\n * Agent Overrides Schema (passthrough for oh-my-opencode compatibility)\n * Simplified version supporting core fields only\n */\n\nexport const AgentOverrideSchema = z.object({\n  model: z.string().optional(),\n  variant: z.string().optional(),\n  temperature: z.number().optional(),\n  prompt: z.string().optional(),\n  skills: z.array(z.string()).optional(),\n  disable: z.boolean().optional(),\n  description: z.string().optional(),\n});\n\nexport const AgentOverridesSchema = z\n  .record(z.string(), AgentOverrideSchema)\n  .optional();\n\n/**\n * Category Config Schema (passthrough for oh-my-opencode compatibility)\n * Simplified version supporting core fields only\n */\n\nexport const CategoryConfigSchema = z.object({\n  description: z.string().optional(),\n  model: z.string().optional(),\n  variant: z.string().optional(),\n  temperature: z.number().optional(),\n  maxTokens: z.number().optional(),\n});\n\nexport const CategoriesSchema = z\n  .record(z.string(), CategoryConfigSchema)\n  .optional();\n\n/**\n * Provider Configuration Schema\n */\n\nexport const ProviderConfigSchema = z.object({\n  priority_chain: z.array(z.string()).optional(),\n  research_providers: z.array(z.string()).optional(),\n  strategy_providers: z.array(z.string()).optional(),\n  config: z\n    .record(\n      z.string(),\n      z.record(z.string(), z.string().or(z.boolean()).or(z.number())).optional()\n    )\n    .optional(),\n});\n\n/**\n * Analytics Configuration Schema\n * Note: This is a simplified version for RoutingLogger integration\n */\n\nexport const RoutingAnalyticsConfigSchema = z.object({\n  enabled: z.boolean().default(true),\n  storage_file: z.string().default(\"analytics.json\"),\n  max_events: z.number().int().positive().default(10000),\n  retention_days: z.number().int().positive().default(90),\n  auto_prune: z.boolean().default(true),\n});\n\n/**\n * Routing Logger Configuration Schema\n */\n\nexport const RoutingLoggerConfigSchema = z.object({\n  enabled: z.boolean().optional(),\n  output: z.enum([\"console\", \"file\", \"disabled\"]).optional(),\n  log_file: z.string().optional(),\n  debug_mode: z.boolean().optional(),\n  analytics_config: RoutingAnalyticsConfigSchema.optional(),\n});\n\n/**\n * Analytics Configuration Schema\n */\n\nexport const AnalyticsConfigSchema = z.object({\n  enabled: z.boolean().optional(),\n  storage: z\n    .object({\n      type: z.enum([\"memory\", \"file\", \"database\"]).optional(),\n      path: z.string().optional(),\n      retention_days: z.number().int().positive().optional(),\n    })\n    .optional(),\n  metrics: z\n    .object({\n      track_routing_decisions: z.boolean().optional(),\n      track_execution_time: z.boolean().optional(),\n      track_agent_usage: z.boolean().optional(),\n      track_model_costs: z.boolean().optional(),\n      track_success_rates: z.boolean().optional(),\n    })\n    .optional(),\n  aggregation: z\n    .object({\n      enabled: z.boolean().optional(),\n      window_minutes: z.number().int().positive().optional(),\n      include_percentiles: z.boolean().optional(),\n    })\n    .optional(),\n});\n\n/**\n * Project Override Schema\n * Allows project-specific overrides to shared configurations\n */\n\nexport const ProjectOverrideSchema = z.object({\n  // Meta-agent overrides\n  meta_agents: z.record(z.string(), MetaAgentSchema.partial()).optional(),\n\n  // Provider configuration overrides\n  providers: ProviderConfigSchema.partial().optional(),\n\n  // Settings overrides\n  settings: SettingsSchema.partial().optional(),\n\n  // Agent overrides (passthrough for oh-my-opencode compatibility)\n  agents: AgentOverridesSchema.optional(),\n\n  // Category overrides\n  categories: CategoriesSchema.optional(),\n\n  // Skills overrides\n  skills: z.array(z.string()).optional(),\n});\n\n/**\n * Project Configuration Schema\n * Defines the configuration for an individual project\n */\n\nexport const ProjectConfigSchema = z.object({\n  // Unique project identifier\n  project_id: z.string().min(1),\n\n  // Optional project display name\n  name: z.string().optional(),\n\n  // Path to the project directory\n  path: z.string().optional(),\n\n  // Project-specific overrides\n  overrides: ProjectOverrideSchema.optional(),\n\n  // Project metadata\n  metadata: z\n    .object({\n      description: z.string().optional(),\n      tags: z.array(z.string()).optional(),\n      created_at: z.string().optional(),\n      updated_at: z.string().optional(),\n    })\n    .optional(),\n\n  // Analytics configuration for this project\n  analytics_enabled: z.boolean().default(true),\n});\n\n/**\n * Shared Configuration Schema\n * Defines shared configurations that can be inherited by projects\n */\n\nexport const SharedConfigSchema = z.object({\n  // Base configuration that all projects inherit\n  base_config: OlimpusConfigSchema.optional(),\n\n  // Default project configuration template\n  default_project: ProjectConfigSchema.partial().optional(),\n\n  // Global routing rules that apply to all projects\n  global_routing_rules: z.array(RoutingRuleSchema).optional(),\n\n  // Shared meta-agents available to all projects\n  shared_meta_agents: z.record(z.string(), MetaAgentSchema).optional(),\n});\n\n/**\n * Portfolio Configuration Schema\n * Portfolio-level settings for cross-project orchestration\n */\n\nexport const PortfolioConfigSchema = z.object({\n  // Enable cross-project analytics aggregation\n  enable_aggregation: z.boolean().default(true),\n\n  // Enable cross-project agent delegation\n  enable_cross_project_delegation: z.boolean().default(true),\n\n  // Agent namespace format for cross-project delegation\n  agent_namespace_format: z.string().default(\"{project_id}:{agent_name}\"),\n\n  // Default project to use when no project is specified\n  default_project_id: z.string().optional(),\n\n  // Maximum delegation depth across projects\n  max_cross_project_depth: z.number().int().positive().default(5),\n\n  // Analytics aggregation settings\n  aggregation_settings: z\n    .object({\n      // Minimum confidence threshold for portfolio-wide metrics\n      min_confidence_threshold: z.number().min(0).max(1).default(0.8),\n\n      // Window for rolling aggregation (in days)\n      aggregation_window_days: z.number().int().positive().default(30),\n\n      // Include anonymized project-level data in portfolio stats\n      include_project_anonymization: z.boolean().default(true),\n    })\n    .optional(),\n});\n\n/**\n * Project Registry Configuration Schema\n * Top-level schema for managing multiple project configurations\n */\n\nexport const ProjectRegistryConfigSchema = z.object({\n  // Portfolio-wide settings\n  portfolio: PortfolioConfigSchema.optional(),\n\n  // Shared configurations available to all projects\n  shared_config: SharedConfigSchema.optional(),\n\n  // Individual project configurations\n  projects: z.record(z.string(), ProjectConfigSchema).default({}),\n\n  // Registry metadata\n  registry: z\n    .object({\n      // Registry version\n      version: z.string().default(\"1.0.0\"),\n\n      // Registry identifier\n      registry_id: z.string().optional(),\n\n      // Timestamp when registry was created\n      created_at: z.string().optional(),\n\n      // Timestamp when registry was last updated\n      updated_at: z.string().optional(),\n    })\n    .optional(),\n});\n\n/**\n * Olimpus Settings Schema (Extended with oh-my-opencode integration)\n */\n\nexport const SettingsSchema = z.object({\n  namespace_prefix: z.string().default(\"olimpus\"),\n  max_delegation_depth: z.number().int().positive().default(3),\n\n  // Background parallelization\n  background_parallelization: z\n    .object({\n      enabled: z.boolean().optional(),\n      max_parallel_tasks: z.number().int().positive().optional(),\n      timeout_ms: z.number().int().positive().optional(),\n    })\n    .optional(),\n\n  // Adaptive model selection\n  adaptive_model_selection: z\n    .object({\n      enabled: z.boolean().optional(),\n      research_model: z.string().optional(),\n      strategy_model: z.string().optional(),\n      default_model: z.string().optional(),\n    })\n    .optional(),\n\n  // Ultrawork and relentless execution\n  ultrawork_enabled: z.boolean().optional(),\n  todo_continuation: z.boolean().optional(),\n  verify_before_completion: z.boolean().optional(),\n\n  // Code quality\n  lsp_refactoring_preferred: z.boolean().optional(),\n  aggressive_comment_pruning: z.boolean().optional(),\n\n  // Routing logger\n  routing_logger: RoutingLoggerConfigSchema.optional(),\n\n  // Analytics\n  analytics: AnalyticsConfigSchema.optional(),\n});\n\n/**\n * Olimpus Config Schema - Top Level\n */\n\nexport const OlimpusConfigSchema = z.object({\n  // Olimpus-specific sections\n  meta_agents: z.record(z.string(), MetaAgentSchema).optional(),\n  providers: ProviderConfigSchema.optional(),\n  settings: SettingsSchema.optional(),\n  skills: z.array(z.string()).optional(),\n\n  // oh-my-opencode passthrough sections\n  agents: AgentOverridesSchema,\n  categories: CategoriesSchema,\n  disabled_hooks: z.array(z.string()).optional(),\n});\n\n/**\n * Inferred TypeScript types from schemas\n */\n\nexport type KeywordMatcher = z.infer<typeof KeywordMatcherSchema>;\nexport type ComplexityMatcher = z.infer<typeof ComplexityMatcherSchema>;\nexport type RegexMatcher = z.infer<typeof RegexMatcherSchema>;\nexport type ProjectContextMatcher = z.infer<typeof ProjectContextMatcherSchema>;\nexport type AlwaysMatcher = z.infer<typeof AlwaysMatcherSchema>;\nexport type Matcher = z.infer<typeof MatcherSchema>;\n\nexport type RoutingRule = z.infer<typeof RoutingRuleSchema>;\nexport type MetaAgentDef = z.infer<typeof MetaAgentSchema>;\nexport type AgentOverride = z.infer<typeof AgentOverrideSchema>;\nexport type CategoryConfig = z.infer<typeof CategoryConfigSchema>;\nexport type ProviderConfig = z.infer<typeof ProviderConfigSchema>;\nexport type RoutingAnalyticsConfig = z.infer<typeof RoutingAnalyticsConfigSchema>;\nexport type RoutingLoggerConfig = z.infer<typeof RoutingLoggerConfigSchema>;\nexport type AnalyticsConfig = z.infer<typeof AnalyticsConfigSchema>;\nexport type Settings = z.infer<typeof SettingsSchema>;\n\nexport type ProjectOverride = z.infer<typeof ProjectOverrideSchema>;\nexport type ProjectConfig = z.infer<typeof ProjectConfigSchema>;\nexport type SharedConfig = z.infer<typeof SharedConfigSchema>;\nexport type PortfolioConfig = z.infer<typeof PortfolioConfigSchema>;\nexport type ProjectRegistryConfig = z.infer<typeof ProjectRegistryConfigSchema>;\n\nexport type OlimpusConfig = z.infer<typeof OlimpusConfigSchema>;\n", "import * as fs from \"fs\";\nimport * as path from \"path\";\nimport { OlimpusConfigSchema } from \"./schema.js\";\nimport { runWizard, type WizardResult } from \"./wizard.js\";\n\n/**\n * Options for scaffolding the Olimpus config\n */\nexport interface ScaffoldOptions {\n  projectConfigExists: boolean;\n  userConfigExists?: boolean;\n  /**\n   * Whether to use interactive wizard instead of silent creation\n   */\n  useWizard?: boolean;\n  /**\n   * Wizard options (only used when useWizard is true)\n   */\n  wizardOptions?: {\n    configPath?: string;\n    autoConfirm?: boolean;\n    input?: NodeJS.ReadableStream;\n    output?: NodeJS.WritableStream;\n  };\n}\n\n/**\n * Result of scaffolding operation\n */\nexport interface ScaffoldResult {\n  path: string;\n  created: boolean;\n}\n\n/**\n * Minimal default config template\n */\nconst DEFAULT_CONFIG = {\n  $schema:\n    \"https://raw.githubusercontent.com/TellMeAlex/ONLY-WORKS-ON-OLYMPUS/refs/heads/master/assets/olimpus.schema.json\",\n  meta_agents: {},\n  settings: {\n    namespace_prefix: \"olimpus\",\n    max_delegation_depth: 3,\n  },\n};\n\n/**\n * Format config as JSONC (JSON with 2-space indent)\n */\nfunction formatJsonc(obj: unknown): string {\n  return JSON.stringify(obj, null, 2);\n}\n\n/**\n * Scaffold Olimpus config at ~/.config/opencode/olimpus.jsonc\n *\n * When useWizard is true: runs interactive wizard to collect user preferences\n * When useWizard is false (default): silently creates minimal default config\n *\n * Logic:\n * 1. If projectConfigExists, skip (return null)\n * 2. If useWizard is true, run interactive wizard and return result\n * 3. Get HOME env var; if undefined, skip (return null)\n * 4. Construct target path: {HOME}/.config/opencode/olimpus.jsonc\n * 5. If file already exists OR userConfigExists, skip (return { path, created: false })\n * 6. Create parent directories recursively; if permission error, skip (return null)\n * 7. Generate minimal JSONC content\n * 8. Validate config before writing\n * 9. Write atomically: {target}.tmp \u2192 rename to {target}\n * 10. Log success message with path\n * 11. Return { path, created: true }\n *\n * On any error (except already-exists): log warning, return null\n */\nexport async function scaffoldOlimpusConfig(\n  options: ScaffoldOptions,\n): Promise<ScaffoldResult | null> {\n  try {\n    // Step 1: Skip if project config exists\n    if (options.projectConfigExists) {\n      return null;\n    }\n\n    // Step 2: If wizard mode is enabled, run interactive wizard\n    if (options.useWizard) {\n      try {\n        const wizardResult: WizardResult = await runWizard(\n          options.wizardOptions ?? {},\n        );\n        return {\n          path: wizardResult.path,\n          created: true,\n        };\n      } catch (error) {\n        const err = error instanceof Error ? error : new Error(String(error));\n        console.warn(`[Olimpus] Wizard failed: ${err.message}`);\n        return null;\n      }\n    }\n\n    // Step 3: Get HOME env var\n    const homeDir = process.env.HOME;\n    if (!homeDir) {\n      console.warn(\n        \"[Olimpus] HOME environment variable not set, skipping config generation\",\n      );\n      return null;\n    }\n\n    // Step 4: Construct target path\n    const targetPath = path.join(\n      homeDir,\n      \".config\",\n      \"opencode\",\n      \"olimpus.jsonc\",\n    );\n\n    // Step 5: Check if file already exists or user config exists\n    if (fs.existsSync(targetPath) || options.userConfigExists) {\n      return {\n        path: targetPath,\n        created: false,\n      };\n    }\n\n    // Step 6: Create parent directories recursively\n    const parentDir = path.dirname(targetPath);\n    try {\n      fs.mkdirSync(parentDir, { recursive: true });\n    } catch (error) {\n      const err = error instanceof Error ? error : new Error(String(error));\n      if (err.message.includes(\"EACCES\") || err.message.includes(\"EROFS\")) {\n        console.warn(\n          `[Olimpus] Permission denied creating directory: ${parentDir}`,\n        );\n        return null;\n      }\n      throw error;\n    }\n\n    // Step 7: Generate minimal JSONC content\n    const content = formatJsonc(DEFAULT_CONFIG);\n\n    // Step 8: Validate config before writing\n    const parsed = JSON.parse(content);\n    const validation = OlimpusConfigSchema.safeParse(parsed);\n    if (!validation.success) {\n      console.warn(\"[Olimpus] Generated config failed validation\");\n      return null;\n    }\n\n    // Step 9: Write atomically (tmp file + rename)\n    const tempPath = `${targetPath}.tmp`;\n    try {\n      fs.writeFileSync(tempPath, content, \"utf-8\");\n      fs.renameSync(tempPath, targetPath);\n    } catch (error) {\n      // Clean up temp file if it exists\n      try {\n        if (fs.existsSync(tempPath)) {\n          fs.unlinkSync(tempPath);\n        }\n      } catch {\n        // Ignore cleanup errors\n      }\n\n      const err = error instanceof Error ? error : new Error(String(error));\n      if (\n        err.message.includes(\"EACCES\") ||\n        err.message.includes(\"EROFS\") ||\n        err.message.includes(\"ENOSPC\")\n      ) {\n        console.warn(`[Olimpus] Failed to write config: ${err.message}`);\n        return null;\n      }\n      throw error;\n    }\n\n    // Step 10: Log success message\n    console.log(`[Olimpus] Generated default config at ${targetPath}`);\n\n    return {\n      path: targetPath,\n      created: true,\n    };\n  } catch (error) {\n    console.warn(\n      `[Olimpus] Scaffolding failed: ${\n        error instanceof Error ? error.message : String(error)\n      }`,\n    );\n    return null;\n  }\n}\n", "import * as readline from \"node:readline\";\nimport * as fs from \"node:fs\";\nimport * as path from \"node:path\";\nimport process from \"node:process\";\nimport type {\n  OlimpusConfig,\n  MetaAgentDef,\n  RoutingRule,\n  ProviderConfig,\n  Settings,\n} from \"./schema.js\";\nimport {\n  type WizardAnswers,\n  type PromptOption,\n  type OptionsPrompt,\n  type SimplePrompt,\n  type WizardPrompt,\n  WIZARD_PROMPTS,\n  PROJECT_TYPES,\n  META_AGENT_PRESETS,\n  PROVIDER_MODELS,\n  SETTING_PRESETS,\n  isOptionsPrompt,\n  isSimplePrompt,\n  getProjectType,\n  getProviderModel,\n  type ProjectTypeId,\n} from \"./prompts.js\";\n\nexport type { WizardAnswers };\n\n/**\n * Config template for a specific project type\n */\ninterface ProjectConfigTemplate {\n  /**\n   * Default meta-agents to enable for this project type\n   */\n  defaultMetaAgents: string[];\n\n  /**\n   * Default agent configurations for this project type\n   */\n  defaultAgents?: Partial<Record<string, { model: string; temperature: number; description: string }>>;\n\n  /**\n   * Default categories for this project type\n   */\n  defaultCategories?: Record<string, { description: string; model?: string; temperature?: number }>;\n\n  /**\n   * Default settings overrides for this project type\n   */\n  defaultSettings?: {\n    background_parallelization?: boolean;\n    adaptive_model_selection?: boolean;\n    lsp_refactoring_preferred?: boolean;\n  };\n}\n\n/**\n * Project type config templates\n * Each project type has sensible defaults for meta-agents, agents, and categories\n */\nconst PROJECT_CONFIG_TEMPLATES: Record<ProjectTypeId, ProjectConfigTemplate> = {\n  /**\n   * Web Application - Frontend-focused development\n   */\n  web: {\n    defaultMetaAgents: [\"atenea\", \"hermes\", \"hefesto\", \"frontend_specialist\"],\n    defaultAgents: {\n      sisyphus: {\n        model: \"claude-sonnet-4-20250217\",\n        temperature: 0.3,\n        description: \"TDD-focused implementation for web apps\",\n      },\n      oracle: {\n        model: \"claude-sonnet-4-20250217\",\n        temperature: 0.5,\n        description: \"Strategic analysis for frontend architecture\",\n      },\n    },\n    defaultCategories: {\n      frontend: {\n        description: \"Frontend development tasks\",\n        model: \"claude-sonnet-4-20250217\",\n        temperature: 0.3,\n      },\n      ui_components: {\n        description: \"UI component development\",\n        model: \"claude-sonnet-4-20250217\",\n        temperature: 0.2,\n      },\n      styling: {\n        description: \"CSS, Tailwind, and styling tasks\",\n        model: \"claude-sonnet-4-20250217\",\n        temperature: 0.2,\n      },\n      testing: {\n        description: \"Frontend testing with vitest/cypress\",\n        model: \"claude-sonnet-4-20250217\",\n        temperature: 0.3,\n      },\n    },\n    defaultSettings: {\n      background_parallelization: true,\n      adaptive_model_selection: true,\n      lsp_refactoring_preferred: true,\n    },\n  },\n\n  /**\n   * Backend API - Server-side development\n   */\n  backend: {\n    defaultMetaAgents: [\"atenea\", \"hermes\", \"hefesto\"],\n    defaultAgents: {\n      sisyphus: {\n        model: \"claude-sonnet-4-20250217\",\n        temperature: 0.3,\n        description: \"TDD-focused implementation for APIs\",\n      },\n      oracle: {\n        model: \"claude-sonnet-4-20250217\",\n        temperature: 0.4,\n        description: \"Strategic analysis for API architecture\",\n      },\n    },\n    defaultCategories: {\n      backend: {\n        description: \"Backend development and API tasks\",\n        model: \"claude-sonnet-4-20250217\",\n        temperature: 0.3,\n      },\n      database: {\n        description: \"Database schema and migrations\",\n        model: \"claude-sonnet-4-20250217\",\n        temperature: 0.2,\n      },\n      api: {\n        description: \"REST/GraphQL API endpoints\",\n        model: \"claude-sonnet-4-20250217\",\n        temperature: 0.3,\n      },\n      testing: {\n        description: \"API testing and integration tests\",\n        model: \"claude-sonnet-4-20250217\",\n        temperature: 0.3,\n      },\n    },\n    defaultSettings: {\n      background_parallelization: true,\n      adaptive_model_selection: true,\n      lsp_refactoring_preferred: true,\n    },\n  },\n\n  /**\n   * Full Stack - Both frontend and backend\n   */\n  fullstack: {\n    defaultMetaAgents: [\"atenea\", \"hermes\", \"hefesto\", \"frontend_specialist\"],\n    defaultAgents: {\n      sisyphus: {\n        model: \"claude-sonnet-4-20250217\",\n        temperature: 0.3,\n        description: \"TDD-focused implementation for full-stack apps\",\n      },\n      oracle: {\n        model: \"claude-sonnet-4-20250217\",\n        temperature: 0.5,\n        description: \"Strategic analysis for full-stack architecture\",\n      },\n    },\n    defaultCategories: {\n      frontend: {\n        description: \"Frontend development tasks\",\n        model: \"claude-sonnet-4-20250217\",\n        temperature: 0.3,\n      },\n      backend: {\n        description: \"Backend development and API tasks\",\n        model: \"claude-sonnet-4-20250217\",\n        temperature: 0.4,\n      },\n      database: {\n        description: \"Database schema and migrations\",\n        model: \"claude-sonnet-4-20250217\",\n        temperature: 0.2,\n      },\n      api: {\n        description: \"REST/GraphQL API endpoints\",\n        model: \"claude-sonnet-4-20250217\",\n        temperature: 0.3,\n      },\n      testing: {\n        description: \"End-to-end and integration tests\",\n        model: \"claude-sonnet-4-20250217\",\n        temperature: 0.3,\n      },\n      deployment: {\n        description: \"CI/CD and deployment configuration\",\n        model: \"claude-sonnet-4-20250217\",\n        temperature: 0.2,\n      },\n    },\n    defaultSettings: {\n      background_parallelization: true,\n      adaptive_model_selection: true,\n      lsp_refactoring_preferred: true,\n    },\n  },\n\n  /**\n   * CLI Tool - Command-line applications\n   */\n  cli: {\n    defaultMetaAgents: [\"atenea\", \"hermes\", \"hefesto\"],\n    defaultAgents: {\n      sisyphus: {\n        model: \"claude-sonnet-4-20250217\",\n        temperature: 0.3,\n        description: \"TDD-focused implementation for CLI tools\",\n      },\n      oracle: {\n        model: \"claude-sonnet-4-20250217\",\n        temperature: 0.4,\n        description: \"Strategic analysis for CLI design\",\n      },\n    },\n    defaultCategories: {\n      core: {\n        description: \"Core CLI logic and commands\",\n        model: \"claude-sonnet-4-20250217\",\n        temperature: 0.3,\n      },\n      ui: {\n        description: \"CLI interface and user experience\",\n        model: \"claude-sonnet-4-20250217\",\n        temperature: 0.2,\n      },\n      testing: {\n        description: \"CLI testing and integration tests\",\n        model: \"claude-sonnet-4-20250217\",\n        temperature: 0.3,\n      },\n      documentation: {\n        description: \"CLI help and documentation\",\n        model: \"claude-sonnet-4-20250217\",\n        temperature: 0.2,\n      },\n    },\n    defaultSettings: {\n      background_parallelization: false,\n      adaptive_model_selection: true,\n      lsp_refactoring_preferred: true,\n    },\n  },\n\n  /**\n   * Library/Package - Reusable code libraries\n   */\n  library: {\n    defaultMetaAgents: [\"atenea\", \"hermes\", \"hefesto\"],\n    defaultAgents: {\n      sisyphus: {\n        model: \"claude-sonnet-4-20250217\",\n        temperature: 0.2,\n        description: \"TDD-focused implementation for libraries\",\n      },\n      oracle: {\n        model: \"claude-sonnet-4-20250217\",\n        temperature: 0.3,\n        description: \"Strategic analysis for API design\",\n      },\n    },\n    defaultCategories: {\n      core: {\n        description: \"Core library functionality\",\n        model: \"claude-sonnet-4-20250217\",\n        temperature: 0.2,\n      },\n      api: {\n        description: \"Public API design and documentation\",\n        model: \"claude-sonnet-4-20250217\",\n        temperature: 0.2,\n      },\n      testing: {\n        description: \"Unit tests and test coverage\",\n        model: \"claude-sonnet-4-20250217\",\n        temperature: 0.2,\n      },\n      examples: {\n        description: \"Example usage and documentation\",\n        model: \"claude-sonnet-4-20250217\",\n        temperature: 0.3,\n      },\n    },\n    defaultSettings: {\n      background_parallelization: false,\n      adaptive_model_selection: true,\n      lsp_refactoring_preferred: true,\n    },\n  },\n\n  /**\n   * Other - Generic or mixed project types\n   */\n  other: {\n    defaultMetaAgents: [\"atenea\", \"hermes\", \"hefesto\"],\n    defaultAgents: {\n      sisyphus: {\n        model: \"claude-sonnet-4-20250217\",\n        temperature: 0.3,\n        description: \"TDD-focused implementation agent\",\n      },\n      oracle: {\n        model: \"claude-sonnet-4-20250217\",\n        temperature: 0.5,\n        description: \"Strategic analysis and architecture advisor\",\n      },\n    },\n    defaultCategories: {\n      general: {\n        description: \"General development tasks\",\n        model: \"claude-sonnet-4-20250217\",\n        temperature: 0.3,\n      },\n      documentation: {\n        description: \"Technical writing and documentation\",\n        model: \"claude-sonnet-4-20250217\",\n        temperature: 0.2,\n      },\n    },\n    defaultSettings: {\n      background_parallelization: true,\n      adaptive_model_selection: true,\n      lsp_refactoring_preferred: true,\n    },\n  },\n};\n\n/**\n * Get config template for a project type\n */\nfunction getProjectTemplate(projectType: string): ProjectConfigTemplate {\n  return PROJECT_CONFIG_TEMPLATES[projectType as ProjectTypeId] || PROJECT_CONFIG_TEMPLATES.other;\n}\n\n/**\n * Result of the wizard execution\n */\nexport interface WizardResult {\n  config: OlimpusConfig;\n  answers: WizardAnswers;\n  path: string;\n}\n\n/**\n * Options for running the wizard\n */\nexport interface WizardOptions {\n  /**\n   * Path where the config should be written\n   * Defaults to ~/.config/opencode/olimpus.jsonc\n   */\n  configPath?: string;\n\n  /**\n   * Whether to skip confirmation prompts\n   */\n  autoConfirm?: boolean;\n\n  /**\n   * Input stream (for testing)\n   */\n  input?: NodeJS.ReadableStream;\n\n  /**\n   * Output stream (for testing)\n   */\n  output?: NodeJS.WritableStream;\n}\n\n/**\n * Readline interface wrapper\n */\nclass ReadlineInterface {\n  private rl: readline.Interface;\n\n  constructor(input: NodeJS.ReadableStream, output: NodeJS.WritableStream) {\n    this.rl = readline.createInterface({\n      input,\n      output,\n      terminal: true,\n    });\n  }\n\n  /**\n   * Ask a single-line question\n   */\n  async question(prompt: string): Promise<string> {\n    return new Promise((resolve) => {\n      this.rl.question(prompt, (answer) => {\n        resolve(answer.trim());\n      });\n    });\n  }\n\n  /**\n   * Ask a password/hidden question (for sensitive input)\n   * Note: Node.js readline doesn't support true hidden input without external deps\n   * This is a placeholder for future enhancement\n   */\n  async questionHidden(prompt: string): Promise<string> {\n    return this.question(prompt);\n  }\n\n  /**\n   * Ask a yes/no question\n   */\n  async confirm(prompt: string, defaultValue = true): Promise<boolean> {\n    const hint = defaultValue ? \" [Y/n]\" : \" [y/N]\";\n    const answer = await this.question(prompt + hint + \": \");\n    if (!answer) {\n      return defaultValue;\n    }\n    const lower = answer.toLowerCase();\n    return lower === \"y\" || lower === \"yes\";\n  }\n\n  /**\n   * Display a message without waiting for input\n   */\n  print(message: string): void {\n    this.rl.write(message);\n  }\n\n  /**\n   * Close the readline interface\n   */\n  close(): void {\n    this.rl.close();\n  }\n}\n\n/**\n * Display options in a formatted list\n */\nfunction displayOptions(options: PromptOption[], selectedIndex?: number): void {\n  options.forEach((opt, index) => {\n    const prefix = index === selectedIndex ? \"> \" : \"  \";\n    const description = opt.description ? ` - ${opt.description}` : \"\";\n    console.log(`${prefix}${index + 1}. ${opt.label}${description}`);\n  });\n}\n\n/**\n * Display multiple selection options with checkboxes\n */\nfunction displayMultiSelectOptions(\n  options: PromptOption[],\n  selectedIndices: Set<number>,\n): void {\n  options.forEach((opt, index) => {\n    const selected = selectedIndices.has(index);\n    const checkbox = selected ? \"[x]\" : \"[ ]\";\n    const description = opt.description ? ` - ${opt.description}` : \"\";\n    console.log(`  ${checkbox} ${index + 1}. ${opt.label}${description}`);\n  });\n}\n\n/**\n * Navigate through a menu with arrow keys or number selection\n */\nasync function selectOption(\n  rli: ReadlineInterface,\n  prompt: string,\n  help?: string,\n): Promise<PromptOption> {\n  // Get options from the prompt\n  const optionsPrompt: OptionsPrompt =\n    WIZARD_PROMPTS[prompt as keyof typeof WIZARD_PROMPTS] as OptionsPrompt;\n  if (!isOptionsPrompt(optionsPrompt)) {\n    throw new Error(`Prompt \"${prompt}\" is not an options prompt`);\n  }\n\n  const options = optionsPrompt.options;\n\n  if (help) {\n    console.log(`\uD83D\uDCA1 ${help}\\n`);\n  }\n\n  // Simple numeric selection for now\n  // TODO: Add arrow key navigation support\n  displayOptions(options);\n  console.log(\"\");\n\n  while (true) {\n    const answer = await rli.question(\"Select option (1-\" + options.length + \"): \");\n    const num = parseInt(answer, 10);\n\n    if (isNaN(num) || num < 1 || num > options.length) {\n      console.log(`Invalid selection. Please enter a number between 1 and ${options.length}.`);\n      continue;\n    }\n\n    return options[num - 1]!;\n  }\n}\n\n/**\n * Navigate through a multi-select menu\n */\nasync function selectMultipleOptions(\n  rli: ReadlineInterface,\n  prompt: string,\n  help?: string,\n  defaults?: boolean[],\n): Promise<PromptOption[]> {\n  const optionsPrompt: OptionsPrompt =\n    WIZARD_PROMPTS[prompt as keyof typeof WIZARD_PROMPTS] as OptionsPrompt;\n  if (!isOptionsPrompt(optionsPrompt)) {\n    throw new Error(`Prompt \"${prompt}\" is not an options prompt`);\n  }\n\n  const options = optionsPrompt.options;\n  const selected = new Set<number>();\n\n  // Initialize with defaults\n  if (defaults) {\n    defaults.forEach((enabled, index) => {\n      if (enabled) selected.add(index);\n    });\n  }\n\n  if (help) {\n    console.log(`\uD83D\uDCA1 ${help}`);\n    console.log(\"Select multiple options, then press 'd' when done.\\n\");\n  }\n\n  while (true) {\n    console.clear();\n    displayMultiSelectOptions(options, selected);\n    console.log(\"\");\n    console.log(\"Toggle: <number>  |  Done: d  |  Clear all: c\");\n\n    const answer = await rli.question(\"> \");\n    const lower = answer.toLowerCase();\n\n    if (lower === \"d\") {\n      if (selected.size === 0) {\n        console.log(\"Please select at least one option.\");\n        continue;\n      }\n      break;\n    }\n\n    if (lower === \"c\") {\n      selected.clear();\n      continue;\n    }\n\n    const num = parseInt(answer, 10);\n    if (!isNaN(num) && num >= 1 && num <= options.length) {\n      const index = num - 1;\n      if (selected.has(index)) {\n        selected.delete(index);\n      } else {\n        selected.add(index);\n      }\n    }\n  }\n\n  return Array.from(selected).map<PromptOption>((i) => options[i]!);\n}\n\n/**\n * Ask for text input\n */\nasync function askText(\n  rli: ReadlineInterface,\n  promptId: string,\n  defaultValue?: string,\n): Promise<string> {\n  const promptObj: WizardPrompt =\n    WIZARD_PROMPTS[promptId as keyof typeof WIZARD_PROMPTS] as WizardPrompt;\n  if (!isSimplePrompt(promptObj) || typeof promptObj.message === \"function\") {\n    throw new Error(`Prompt \"${promptId}\" is not a simple text prompt`);\n  }\n\n  const promptText = defaultValue\n    ? `${promptObj.message} [${defaultValue}]: `\n    : `${promptObj.message}: `;\n\n  const answer = await rli.question(promptText);\n  return answer || defaultValue || \"\";\n}\n\n/**\n * Display a message and wait for user to continue\n */\nasync function showMessage(\n  rli: ReadlineInterface,\n  promptId: string,\n  ...args: unknown[]\n): Promise<void> {\n  const promptObj: WizardPrompt =\n    WIZARD_PROMPTS[promptId as keyof typeof WIZARD_PROMPTS] as WizardPrompt;\n  if (!isSimplePrompt(promptObj)) {\n    throw new Error(`Prompt \"${promptId}\" is not a simple prompt`);\n  }\n\n  const message =\n    typeof promptObj.message === \"function\"\n      ? promptObj.message(...args)\n      : promptObj.message;\n\n  console.log(message);\n  await rli.question(\"\");\n}\n\n/**\n * Create meta-agent definitions based on selections\n */\nfunction createMetaAgents(\n  selectedIds: string[],\n  baseModel: string,\n): Record<string, MetaAgentDef> {\n  const templates: Record<string, MetaAgentDef> = {\n    atenea: {\n      base_model: baseModel,\n      delegates_to: [\"oracle\", \"prometheus\", \"atlas\", \"metis\"],\n      routing_rules: [\n        {\n          matcher: { type: \"complexity\", threshold: \"high\" },\n          target_agent: \"oracle\",\n          config_overrides: {\n            prompt:\n              \"You are a strategic architecture advisor. Analyze this complex problem from first principles, considering system design patterns, scalability, maintainability, and long-term implications.\",\n          },\n        },\n        {\n          matcher: { type: \"always\" },\n          target_agent: \"metis\",\n          config_overrides: {\n            prompt:\n              \"You are a general technical analyst. Synthesize information and provide comprehensive analysis.\",\n          },\n        },\n      ],\n    },\n    hermes: {\n      base_model: baseModel,\n      delegates_to: [\"librarian\", \"explore\", \"oracle\"],\n      routing_rules: [\n        {\n          matcher: {\n            type: \"keyword\",\n            keywords: [\"docs\", \"documentation\", \"guide\", \"search\", \"lookup\"],\n            mode: \"any\",\n          },\n          target_agent: \"librarian\",\n          config_overrides: {\n            prompt: \"You are a research specialist. Search comprehensively for documentation and guides.\",\n          },\n        },\n        {\n          matcher: { type: \"always\" },\n          target_agent: \"librarian\",\n        },\n      ],\n    },\n    hefesto: {\n      base_model: baseModel,\n      delegates_to: [\"sisyphus\", \"hephaestus\"],\n      temperature: 0.3,\n      routing_rules: [\n        {\n          matcher: {\n            type: \"project_context\",\n            has_files: [\"package.json\"],\n            has_deps: [\"vitest\", \"jest\", \"bun:test\"],\n          },\n          target_agent: \"sisyphus\",\n          config_overrides: {\n            prompt: \"You are a TDD expert. Write tests first, then implementation.\",\n            variant: \"tdd\",\n          },\n        },\n        {\n          matcher: { type: \"always\" },\n          target_agent: \"hephaestus\",\n          config_overrides: {\n            prompt:\n              \"You are a builder. Implement with attention to quality and best practices.\",\n          },\n        },\n      ],\n    },\n    frontend_specialist: {\n      base_model: baseModel,\n      delegates_to: [\"hephaestus\", \"oracle\"],\n      routing_rules: [\n        {\n          matcher: {\n            type: \"regex\",\n            pattern: \"^(design|ui|component|button|form|style)\",\n            flags: \"i\",\n          },\n          target_agent: \"hephaestus\",\n          config_overrides: {\n            prompt: \"You are a frontend specialist. Build responsive, accessible UI components.\",\n          },\n        },\n        {\n          matcher: { type: \"always\" },\n          target_agent: \"hephaestus\",\n        },\n      ],\n    },\n  };\n\n  const result: Record<string, MetaAgentDef> = {};\n  for (const id of selectedIds) {\n    if (templates[id]) {\n      result[id] = templates[id];\n    }\n  }\n\n  return result;\n}\n\n/**\n * Create provider configuration based on model selections\n */\nfunction createProviderConfig(\n  primaryModel: string,\n  researchModel: string,\n): ProviderConfig {\n  const primaryModelData = getProviderModel(primaryModel);\n  const researchModelData = getProviderModel(researchModel);\n\n  const primaryProvider = primaryModelData?.provider || \"anthropic\";\n  const researchProvider = researchModelData?.provider || \"anthropic\";\n\n  return {\n    priority_chain: [\n      `${primaryProvider}/${primaryModel}`,\n      `${researchProvider}/${researchModel}`,\n    ],\n    research_providers: [`${researchProvider}/${researchModel}`],\n    strategy_providers: [`${primaryProvider}/${primaryModel}`],\n    config: {\n      anthropic: { retry_on_rate_limit: true },\n      openai: { retry_on_rate_limit: true },\n      google: { retry_on_rate_limit: true },\n    },\n  };\n}\n\n/**\n * Create settings configuration based on feature selections\n * @param selectedKeys - Settings explicitly selected by user\n * @param primaryModel - Primary model for strategy tasks\n * @param researchModel - Research model for background tasks\n * @param projectDefaults - Project type-specific default settings\n */\nfunction createSettings(\n  selectedKeys: string[],\n  primaryModel: string,\n  researchModel: string,\n  projectDefaults?: ProjectConfigTemplate[\"defaultSettings\"],\n): Settings {\n  const backgroundParallelization =\n    selectedKeys.includes(\"background_parallelization\") ||\n    projectDefaults?.background_parallelization === true;\n  const adaptiveModelSelection =\n    selectedKeys.includes(\"adaptive_model_selection\") ||\n    projectDefaults?.adaptive_model_selection === true;\n  const ultraworkEnabled = selectedKeys.includes(\"ultrawork_enabled\");\n  const todoContinuation = selectedKeys.includes(\"todo_continuation\");\n  const verifyBeforeCompletion = selectedKeys.includes(\"verify_before_completion\");\n  const lspRefactoringPreferred =\n    selectedKeys.includes(\"lsp_refactoring_preferred\") ||\n    projectDefaults?.lsp_refactoring_preferred === true;\n  const aggressiveCommentPruning = selectedKeys.includes(\"aggressive_comment_pruning\");\n\n  return {\n    namespace_prefix: \"olimpus\",\n    max_delegation_depth: 3,\n    background_parallelization: backgroundParallelization\n      ? {\n          enabled: true,\n          max_parallel_tasks: 3,\n          timeout_ms: 30000,\n        }\n      : undefined,\n    adaptive_model_selection: adaptiveModelSelection\n      ? {\n          enabled: true,\n          research_model: researchModel,\n          strategy_model: primaryModel,\n          default_model: \"claude-sonnet-4-20250217\",\n        }\n      : undefined,\n    ultrawork_enabled: ultraworkEnabled,\n    todo_continuation: todoContinuation,\n    verify_before_completion: verifyBeforeCompletion,\n    lsp_refactoring_preferred: lspRefactoringPreferred,\n    aggressive_comment_pruning: aggressiveCommentPruning,\n  };\n}\n\n/**\n * Schema URL for JSONC files\n */\nconst SCHEMA_URL =\n  \"https://raw.githubusercontent.com/TellMeAlex/ONLY-WORKS-ON-OLYMPUS/refs/heads/master/assets/olimpus.schema.json\";\n\n/**\n * Build Olimpus configuration from wizard answers\n */\nfunction buildConfig(answers: WizardAnswers): OlimpusConfig {\n  const primaryModel = answers.primary_model;\n  const researchModel = answers.research_model;\n  const projectTemplate = getProjectTemplate(answers.project_type);\n\n  // Determine meta-agents to use: user selection or project template defaults\n  const metaAgentIds =\n    answers.meta_agents && answers.meta_agents.length > 0\n      ? answers.meta_agents\n      : projectTemplate.defaultMetaAgents;\n\n  // Determine settings to use: user selection or empty (let template defaults apply in createSettings)\n  const settings = answers.settings ?? [];\n\n  // Build agents configuration: start with template defaults, then merge with models\n  const agents: NonNullable<OlimpusConfig[\"agents\"]> = {\n    ...(projectTemplate.defaultAgents as NonNullable<OlimpusConfig[\"agents\"]>),\n  };\n\n  // Update all agents to use the selected primary model\n  for (const agentId in agents) {\n    if (agents[agentId]) {\n      agents[agentId]!.model = primaryModel;\n    }\n  }\n\n  // Build categories: apply primary model if not specified in template\n  const categories: NonNullable<OlimpusConfig[\"categories\"]> = {};\n  if (projectTemplate.defaultCategories) {\n    for (const [categoryId, categoryDef] of Object.entries(\n      projectTemplate.defaultCategories,\n    )) {\n      categories[categoryId] = {\n        description: categoryDef.description,\n        model: categoryDef.model ?? primaryModel,\n        temperature: categoryDef.temperature ?? 0.3,\n      };\n    }\n  }\n\n  return {\n    meta_agents: metaAgentIds.length > 0 ? createMetaAgents(metaAgentIds, primaryModel) : undefined,\n    providers: createProviderConfig(primaryModel, researchModel),\n    settings: createSettings(settings, primaryModel, researchModel, projectTemplate.defaultSettings),\n    skills: answers.skills_path ? [answers.skills_path] : undefined,\n    agents,\n    categories,\n    disabled_hooks: [],\n  };\n}\n\n/**\n * Format configuration as JSONC with schema\n */\nfunction formatConfigAsJsonc(config: OlimpusConfig): string {\n  const jsonString = JSON.stringify(config, null, 2);\n  // Prepend schema URL\n  return `{\n  \"$schema\": \"${SCHEMA_URL}\",\\n` + jsonString.slice(1);\n}\n\n/**\n * Main wizard flow - collects user answers and generates config\n */\nexport async function runWizard(\n  options: WizardOptions = {},\n): Promise<WizardResult> {\n  const input = options.input ?? process.stdin;\n  const output = options.output ?? process.stdout;\n\n  const rli = new ReadlineInterface(input, output);\n\n  try {\n    // Welcome screen\n    await showMessage(rli, \"welcome\");\n\n    // Collect answers\n    const answers: WizardAnswers = {\n      project_type: \"\",\n      language: \"\",\n      primary_model: \"\",\n      research_model: \"\",\n    };\n\n    // Project type\n    const projectType = await selectOption(rli, \"project_type\", WIZARD_PROMPTS.project_type.help);\n    answers.project_type = projectType.value;\n\n    // Language\n    const language = await selectOption(rli, \"language\", WIZARD_PROMPTS.language.help);\n    answers.language = language.value;\n\n    // Meta-agents\n    const metaAgents = await selectMultipleOptions(\n      rli,\n      \"meta_agents\",\n      WIZARD_PROMPTS.meta_agents.help,\n      META_AGENT_PRESETS.map((m) => m.enabled_by_default),\n    );\n    answers.meta_agents = metaAgents.map((a) => a.value);\n\n    // Primary model\n    const primaryModel = await selectOption(\n      rli,\n      \"primary_model\",\n      WIZARD_PROMPTS.primary_model.help,\n    );\n    answers.primary_model = primaryModel.value;\n\n    // Research model\n    const researchModel = await selectOption(\n      rli,\n      \"research_model\",\n      WIZARD_PROMPTS.research_model.help,\n    );\n    answers.research_model = researchModel.value;\n\n    // Settings\n    const settings = await selectMultipleOptions(\n      rli,\n      \"settings\",\n      WIZARD_PROMPTS.settings.help,\n      SETTING_PRESETS.map((s) => s.enabled_by_default),\n    );\n    answers.settings = settings.map((s) => s.value);\n\n    // Skills path (optional)\n    const skillsPath = await askText(\n      rli,\n      \"skills_path\",\n      WIZARD_PROMPTS.skills_path.default,\n    );\n    if (skillsPath) {\n      answers.skills_path = skillsPath;\n    }\n\n    // Display summary\n    console.log(\"\");\n    await showMessage(rli, \"summary\", answers);\n\n    // Build config\n    const config = buildConfig(answers);\n\n    // Determine config path\n    let configPath = options.configPath;\n    if (!configPath) {\n      const homeDir = process.env.HOME;\n      if (homeDir) {\n        configPath = path.join(homeDir, \".config\", \"opencode\", \"olimpus.jsonc\");\n      } else {\n        throw new Error(\"HOME environment variable not set\");\n      }\n    }\n\n    // Create parent directories if needed\n    const parentDir = path.dirname(configPath);\n    if (!fs.existsSync(parentDir)) {\n      fs.mkdirSync(parentDir, { recursive: true });\n    }\n\n    // Write config\n    const content = formatConfigAsJsonc(config);\n    fs.writeFileSync(configPath, content, \"utf-8\");\n\n    // Success message\n    console.log(\"\");\n    await showMessage(rli, \"success\", configPath);\n\n    return {\n      config,\n      answers,\n      path: configPath,\n    };\n  } finally {\n    rli.close();\n  }\n}\n\n/**\n * Run wizard in non-interactive mode with preset answers\n * Useful for testing or automated setup\n */\nexport async function runWizardNonInteractive(\n  presetAnswers: Partial<WizardAnswers>,\n  options: WizardOptions = {},\n): Promise<WizardResult> {\n  const config = buildConfig({\n    project_type: presetAnswers.project_type ?? \"web\",\n    language: presetAnswers.language ?? \"typescript\",\n    meta_agents: presetAnswers.meta_agents ?? [\"atenea\", \"hermes\", \"hefesto\"],\n    primary_model: presetAnswers.primary_model ?? \"claude-sonnet-4-20250217\",\n    research_model: presetAnswers.research_model ?? \"claude-haiku-4-5\",\n    settings: presetAnswers.settings ?? [\n      \"background_parallelization\",\n      \"adaptive_model_selection\",\n    ],\n    skills_path: presetAnswers.skills_path,\n  });\n\n  let configPath = options.configPath;\n  if (!configPath) {\n    const homeDir = process.env.HOME;\n    if (homeDir) {\n      configPath = path.join(homeDir, \".config\", \"opencode\", \"olimpus.jsonc\");\n    } else {\n      throw new Error(\"HOME environment variable not set\");\n    }\n  }\n\n  const parentDir = path.dirname(configPath);\n  if (!fs.existsSync(parentDir)) {\n    fs.mkdirSync(parentDir, { recursive: true });\n  }\n\n  const content = formatConfigAsJsonc(config);\n  fs.writeFileSync(configPath, content, \"utf-8\");\n\n  return {\n    config,\n    answers: presetAnswers as WizardAnswers,\n    path: configPath,\n  };\n}\n", "/**\n * Project types supported by the wizard\n * Each type maps to different default configurations\n */\nexport const PROJECT_TYPES = [\n  {\n    id: \"web\",\n    name: \"Web Application\",\n    description: \"Frontend web app (React, Vue, Svelte, etc.)\",\n    icon: \"\uD83C\uDF10\",\n  },\n  {\n    id: \"backend\",\n    name: \"Backend API\",\n    description: \"REST/GraphQL API server\",\n    icon: \"\u2699\uFE0F\",\n  },\n  {\n    id: \"fullstack\",\n    name: \"Full Stack\",\n    description: \"Both frontend and backend\",\n    icon: \"\uD83D\uDD17\",\n  },\n  {\n    id: \"cli\",\n    name: \"CLI Tool\",\n    description: \"Command-line application\",\n    icon: \"\uD83D\uDCBB\",\n  },\n  {\n    id: \"library\",\n    name: \"Library/Package\",\n    description: \"Reusable code library\",\n    icon: \"\uD83D\uDCE6\",\n  },\n  {\n    id: \"other\",\n    name: \"Other\",\n    description: \"Something else or mixed\",\n    icon: \"\uD83D\uDD27\",\n  },\n] as const;\n\n/**\n * Programming language options\n */\nexport const LANGUAGES = [\n  \"TypeScript\",\n  \"JavaScript\",\n  \"Python\",\n  \"Rust\",\n  \"Go\",\n  \"Java\",\n  \"C#\",\n  \"Other\",\n] as const;\n\n/**\n * Meta-agent presets with descriptions\n * Users can select which meta-agents to enable\n */\nexport const META_AGENT_PRESETS = [\n  {\n    id: \"atenea\",\n    name: \"Atenea\",\n    description: \"Strategic planning & architecture analysis\",\n    enabled_by_default: true,\n  },\n  {\n    id: \"hermes\",\n    name: \"Hermes\",\n    description: \"Communication & research\",\n    enabled_by_default: true,\n  },\n  {\n    id: \"hefesto\",\n    name: \"Hefesto\",\n    description: \"Implementation & building\",\n    enabled_by_default: true,\n  },\n  {\n    id: \"frontend_specialist\",\n    name: \"Frontend Specialist\",\n    description: \"UI components & frontend tasks\",\n    enabled_by_default: false,\n  },\n] as const;\n\n/**\n * Provider model options\n * Common model names for user selection\n */\nexport const PROVIDER_MODELS = [\n  {\n    id: \"claude-opus-4-20250205\",\n    provider: \"anthropic\",\n    name: \"Claude Opus 4.6\",\n    description: \"Most capable model, excellent for complex reasoning and coding (Feb 2026)\",\n  },\n  {\n    id: \"claude-sonnet-4-20250217\",\n    provider: \"anthropic\",\n    name: \"Claude Sonnet 4.6\",\n    description: \"Best balance of speed and intelligence, 1M tokens, default for Pro (Feb 2026)\",\n  },\n  {\n    id: \"claude-haiku-4-20251022\",\n    provider: \"anthropic\",\n    name: \"Claude Haiku 4.5\",\n    description: \"Fast and cost-effective for research and simple tasks\",\n  },\n  {\n    id: \"claude-opus-4-20241105\",\n    provider: \"anthropic\",\n    name: \"Claude Opus 4.5\",\n    description: \"Previous generation Opus, excellent for coding and agents\",\n  },\n  {\n    id: \"claude-3-5-sonnet-20241022\",\n    provider: \"anthropic\",\n    name: \"Claude 3.5 Sonnet (Legacy)\",\n    description: \"Legacy model, still stable for backward compatibility\",\n  },\n  {\n    id: \"gpt-5.2\",\n    provider: \"openai\",\n    name: \"GPT 5.2\",\n    description: \"OpenAI's flagship model\",\n  },\n  {\n    id: \"gemini-3-pro\",\n    provider: \"google\",\n    name: \"Gemini 3 Pro\",\n    description: \"Google's advanced model\",\n  },\n] as const;\n\n/**\n * Setting presets with descriptions\n * Users can enable/disable key Olimpus features\n */\nexport const SETTING_PRESETS = [\n  {\n    key: \"background_parallelization\",\n    name: \"Background Parallelization\",\n    description:\n      \"Run research tasks in background while main agent executes\",\n    enabled_by_default: true,\n  },\n  {\n    key: \"adaptive_model_selection\",\n    name: \"Adaptive Model Selection\",\n    description: \"Use cheap models for research, expensive for decisions\",\n    enabled_by_default: true,\n  },\n  {\n    key: \"ultrawork_enabled\",\n    name: \"Ultrawork Mode\",\n    description:\n      \"Relentless execution - tasks don't stop halfway\",\n    enabled_by_default: true,\n  },\n  {\n    key: \"todo_continuation\",\n    name: \"Todo Continuation\",\n    description: \"Continue if agent stops mid-task\",\n    enabled_by_default: true,\n  },\n  {\n    key: \"verify_before_completion\",\n    name: \"Verify Before Completion\",\n    description: \"Double-check work before declaring done\",\n    enabled_by_default: true,\n  },\n  {\n    key: \"lsp_refactoring_preferred\",\n    name: \"LSP Refactoring\",\n    description: \"Use AST-based refactoring (no string replacement)\",\n    enabled_by_default: true,\n  },\n  {\n    key: \"aggressive_comment_pruning\",\n    name: \"Comment Pruning\",\n    description: \"Remove verbose AI-generated comments\",\n    enabled_by_default: true,\n  },\n] as const;\n\n/**\n * Wizard prompt definitions\n * Each prompt has an ID, question text, and optional help text\n */\nexport const WIZARD_PROMPTS = {\n  /**\n   * Welcome message and introduction\n   */\n  welcome: {\n    id: \"welcome\",\n    message: `\n\u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557\n\u2551              Welcome to Olimpus Setup Wizard                     \u2551\n\u255A\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255D\n\nThis wizard will help you create your first Olimpus configuration.\n\nOlimpus is an intelligent meta-orchestrator that routes your tasks\nto specialized agents based on context and complexity.\n\nYou can run this wizard anytime by running: opencode olimpus init\n\nPress Enter to continue...\n`,\n  },\n\n  /**\n   * Project type selection\n   */\n  project_type: {\n    id: \"project_type\",\n    question: \"What type of project is this?\",\n    help: \"This helps Olimpus select appropriate meta-agents and defaults\",\n    options: PROJECT_TYPES.map((t) => ({\n      value: t.id,\n      label: `${t.icon} ${t.name}`,\n      description: t.description,\n    })),\n  },\n\n  /**\n   * Primary language selection\n   */\n  language: {\n    id: \"language\",\n    question: \"What is the primary programming language?\",\n    help: \"Used for code generation and project context\",\n    options: LANGUAGES.map((l) => ({\n      value: l.toLowerCase(),\n      label: l,\n    })),\n  },\n\n  /**\n   * Meta-agent selection\n   */\n  meta_agents: {\n    id: \"meta_agents\",\n    question: \"Which meta-agents would you like to enable?\",\n    help: \"Meta-agents intelligently route tasks to specialized workers\",\n    options: META_AGENT_PRESETS.map((m) => ({\n      value: m.id,\n      label: m.name,\n      description: m.description,\n      default: m.enabled_by_default,\n    })),\n  },\n\n  /**\n   * Primary model selection\n   */\n  primary_model: {\n    id: \"primary_model\",\n    question: \"Select your primary AI model\",\n    help: \"This model will be used for most tasks\",\n    options: PROVIDER_MODELS.map((m) => ({\n      value: m.id,\n      label: m.name,\n      description: m.description,\n    })),\n  },\n\n  /**\n   * Research model selection\n   */\n  research_model: {\n    id: \"research_model\",\n    question: \"Select your research model (background tasks)\",\n    help: \"Faster/cheaper model for search and documentation lookups\",\n    options: PROVIDER_MODELS.filter((m) =>\n      m.id.includes(\"haiku\") || m.id.includes(\"turbo\") || m.id.includes(\"flash\"),\n    ).map((m) => ({\n      value: m.id,\n      label: m.name,\n      description: m.description,\n    })),\n  },\n\n  /**\n   * Settings selection\n   */\n  settings: {\n    id: \"settings\",\n    question: \"Which Olimpus features would you like to enable?\",\n    help: \"Enable advanced features for enhanced productivity\",\n    options: SETTING_PRESETS.map((s) => ({\n      value: s.key,\n      label: s.name,\n      description: s.description,\n      default: s.enabled_by_default,\n    })),\n  },\n\n  /**\n   * Skills path (optional)\n   */\n  skills_path: {\n    id: \"skills_path\",\n    message: \"Path to custom skills directory (optional, leave empty to skip)\",\n    default: \"\",\n  },\n\n  /**\n   * Configuration summary\n   */\n  summary: {\n    id: \"summary\",\n    message: (answers: WizardAnswers) => `\n\u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557\n\u2551                    Configuration Summary                         \u2551\n\u255A\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255D\n\nProject Type:   ${PROJECT_TYPES.find((t) => t.id === answers.project_type)?.name || \"Unknown\"}\nLanguage:       ${answers.language}\nMeta-Agents:    ${answers.meta_agents?.join(\", \") || \"None\"}\nPrimary Model:  ${answers.primary_model}\nResearch Model: ${answers.research_model}\nFeatures:       ${answers.settings?.join(\", \") || \"None\"}\nSkills Path:    ${answers.skills_path || \"None\"}\n\nConfiguration will be saved to:\n  ~/.config/opencode/olimpus.jsonc\n\nPress Enter to generate configuration or Ctrl+C to cancel...\n`,\n  },\n\n  /**\n   * Success message\n   */\n  success: {\n    id: \"success\",\n    message: (path: string) => `\n\u2705 Configuration created successfully at:\n   ${path}\n\nYou can now use Olimpus! Try:\n  \u2022 \"ulw implement a new feature\" - Ultrawork mode\n  \u2022 \"research API patterns\" - Research mode\n  \u2022 \"@atenea plan architecture\" - Strategic planning\n\nEdit your config at anytime: ~/.config/opencode/olimpus.jsonc\n`,\n  },\n} as const;\n\n/**\n * Type for wizard answers collected from user\n */\nexport interface WizardAnswers {\n  project_type: string;\n  language: string;\n  meta_agents?: string[];\n  primary_model: string;\n  research_model: string;\n  settings?: string[];\n  skills_path?: string;\n}\n\n/**\n * Type for a wizard prompt option\n */\nexport interface PromptOption {\n  value: string;\n  label: string;\n  description?: string;\n  default?: boolean;\n}\n\n/**\n * Type for a wizard prompt with options\n */\nexport interface OptionsPrompt {\n  id: string;\n  question: string;\n  help?: string;\n  options: PromptOption[];\n}\n\n/**\n * Type for a simple prompt without options\n */\nexport interface SimplePrompt {\n  id: string;\n  message: string | ((...args: unknown[]) => string);\n}\n\n/**\n * Union type for all prompt types\n */\nexport type WizardPrompt = OptionsPrompt | SimplePrompt;\n\n/**\n * Inferred TypeScript types from constants\n */\nexport type ProjectTypeId = (typeof PROJECT_TYPES)[number][\"id\"];\nexport type Language = (typeof LANGUAGES)[number];\nexport type MetaAgentPresetId = (typeof META_AGENT_PRESETS)[number][\"id\"];\nexport type ProviderModelId = (typeof PROVIDER_MODELS)[number][\"id\"];\nexport type SettingPresetKey = (typeof SETTING_PRESETS)[number][\"key\"];\n\n/**\n * Type guard for options prompt\n */\nexport function isOptionsPrompt(\n  prompt: WizardPrompt,\n): prompt is OptionsPrompt {\n  return \"options\" in prompt;\n}\n\n/**\n * Type guard for simple prompt\n */\nexport function isSimplePrompt(prompt: WizardPrompt): prompt is SimplePrompt {\n  return \"message\" in prompt;\n}\n\n/**\n * Get project type by ID\n */\nexport function getProjectType(id: string): (typeof PROJECT_TYPES)[number] | undefined {\n  return PROJECT_TYPES.find((t) => t.id === id);\n}\n\n/**\n * Get provider model by ID\n */\nexport function getProviderModel(id: string): (typeof PROVIDER_MODELS)[number] | undefined {\n  return PROVIDER_MODELS.find((m) => m.id === id);\n}\n", "import { z } from \"zod\";\nimport type { OlimpusConfig, MetaAgentDef } from \"./schema.js\";\n\n/**\n * Validation Error Types - Discriminated Union\n */\n\nexport const CircularDependencyErrorSchema = z.object({\n  type: z.literal(\"circular_dependency\"),\n  message: z.string(),\n  path: z.array(z.string()),\n  meta_agents: z.array(z.string()),\n});\n\nexport const InvalidAgentReferenceErrorSchema = z.object({\n  type: z.literal(\"invalid_agent_reference\"),\n  message: z.string(),\n  path: z.array(z.string()),\n  reference: z.string(),\n});\n\nexport const SchemaValidationErrorSchema = z.object({\n  type: z.literal(\"schema_validation\"),\n  message: z.string(),\n  path: z.array(z.string()),\n  zodIssue: z.any().optional(),\n});\n\nexport const RegexPerformanceWarningSchema = z.object({\n  type: z.literal(\"regex_performance\"),\n  message: z.string(),\n  path: z.array(z.string()),\n  pattern: z.string(),\n  reason: z.string(),\n});\n\n/**\n * Validation Error Schema - Union of all error types\n */\n\nexport const ValidationErrorSchema = z.discriminatedUnion(\"type\", [\n  CircularDependencyErrorSchema,\n  InvalidAgentReferenceErrorSchema,\n  SchemaValidationErrorSchema,\n]);\n\n/**\n * Validation Warning Schema\n */\n\nexport const ValidationWarningSchema = z.discriminatedUnion(\"type\", [\n  RegexPerformanceWarningSchema,\n]);\n\n/**\n * Validation Result Schema - Aggregate result of validation\n */\n\nexport const ValidationResultSchema = z.object({\n  valid: z.boolean(),\n  errors: z.array(ValidationErrorSchema).default([]),\n  warnings: z.array(ValidationWarningSchema).default([]),\n  config: z.any().optional(),\n});\n\n/**\n * Severity Levels for filtering issues\n */\n\nexport const SeveritySchema = z.enum([\"error\", \"warning\"]);\nexport const Severity = [\"error\", \"warning\"] as const;\n\n/**\n * Check Type for categorizing validation checks\n */\n\nexport const CheckTypeSchema = z.enum([\n  \"schema\",\n  \"circular_dependency\",\n  \"agent_reference\",\n  \"regex_performance\",\n]);\n\n/**\n * Check Result Schema - Result of a single validation check\n */\n\nexport const CheckResultSchema = z.object({\n  checkType: CheckTypeSchema,\n  passed: z.boolean(),\n  errors: z.array(ValidationErrorSchema).default([]),\n  warnings: z.array(ValidationWarningSchema).default([]),\n});\n\n/**\n * Validation Context Schema - Context for validation\n */\n\nexport const ValidationContextSchema = z.object({\n  configPath: z.string().optional(),\n  configName: z.string().optional(),\n  checkCircularDependencies: z.boolean().default(true),\n  checkAgentReferences: z.boolean().default(true),\n  checkRegexPerformance: z.boolean().default(true),\n});\n\n/**\n * Inferred TypeScript types from schemas\n */\n\nexport type CircularDependencyError = z.infer<\n  typeof CircularDependencyErrorSchema\n>;\nexport type InvalidAgentReferenceError = z.infer<\n  typeof InvalidAgentReferenceErrorSchema\n>;\nexport type SchemaValidationError = z.infer<typeof SchemaValidationErrorSchema>;\n\nexport type ValidationError = z.infer<typeof ValidationErrorSchema>;\n\nexport type RegexPerformanceWarning = z.infer<\n  typeof RegexPerformanceWarningSchema\n>;\n\nexport type ValidationWarning = z.infer<typeof ValidationWarningSchema>;\n\nexport type ValidationResult = z.infer<typeof ValidationResultSchema>;\n\nexport type SeverityLevel = (typeof Severity)[number];\n\nexport type CheckType = z.infer<typeof CheckTypeSchema>;\n\nexport type CheckResult = z.infer<typeof CheckResultSchema>;\n\nexport type ValidationContext = z.infer<typeof ValidationContextSchema>;\n\n/**\n * Create a circular dependency error\n */\n\nexport function createCircularDependencyError(\n  message: string,\n  path: string[],\n  metaAgents: string[],\n): CircularDependencyError {\n  return {\n    type: \"circular_dependency\",\n    message,\n    path,\n    meta_agents: metaAgents,\n  };\n}\n\n/**\n * Create an invalid agent reference error\n */\n\nexport function createInvalidAgentReferenceError(\n  message: string,\n  path: string[],\n  reference: string,\n): InvalidAgentReferenceError {\n  return {\n    type: \"invalid_agent_reference\",\n    message,\n    path,\n    reference,\n  };\n}\n\n/**\n * Create a schema validation error\n */\n\nexport function createSchemaValidationError(\n  message: string,\n  path: string[],\n  zodIssue?: unknown,\n): SchemaValidationError {\n  return {\n    type: \"schema_validation\",\n    message,\n    path,\n    zodIssue,\n  };\n}\n\n/**\n * Create a regex performance warning\n */\n\nexport function createRegexPerformanceWarning(\n  message: string,\n  path: string[],\n  pattern: string,\n  reason: string,\n): RegexPerformanceWarning {\n  return {\n    type: \"regex_performance\",\n    message,\n    path,\n    pattern,\n    reason,\n  };\n}\n\n/**\n * Create a new validation result\n */\n\nexport function createValidationResult(\n  config?: OlimpusConfig,\n): ValidationResult {\n  return {\n    valid: false,\n    errors: [],\n    warnings: [],\n    config,\n  };\n}\n\n/**\n * Create a validation check result\n */\n\nexport function createCheckResult(\n  checkType: CheckType,\n  passed: boolean = false,\n): CheckResult {\n  return {\n    checkType,\n    passed,\n    errors: [],\n    warnings: [],\n  };\n}\n\n/**\n * Check if a validation result is valid (no errors)\n */\n\nexport function isValid(result: ValidationResult): boolean {\n  return result.errors.length === 0;\n}\n\n/**\n * Check if a validation result has warnings\n */\n\nexport function hasWarnings(result: ValidationResult): boolean {\n  return result.warnings.length > 0;\n}\n\n/**\n * Get a summary of validation result as a human-readable string\n */\n\nexport function getValidationSummary(result: ValidationResult): string {\n  const { errors, warnings } = result;\n  const errorCount = errors.length;\n  const warningCount = warnings.length;\n\n  if (errorCount === 0 && warningCount === 0) {\n    return \"Configuration is valid. No errors or warnings found.\";\n  }\n\n  let summary = \"\";\n  if (errorCount > 0) {\n    summary += `${errorCount} error${errorCount === 1 ? \"\" : \"s\"}`;\n  }\n  if (warningCount > 0) {\n    if (summary) summary += \", \";\n    summary += `${warningCount} warning${warningCount === 1 ? \"\" : \"s\"}`;\n  }\n  summary += \" found.\";\n\n  return summary;\n}\n\n/**\n * Format validation errors as a string list\n */\n\nexport function formatErrors(result: ValidationResult): string[] {\n  return result.errors.map((error) => {\n    const pathStr = error.path.length > 0 ? error.path.join(\".\") : \"root\";\n    return `[ERROR] ${pathStr}: ${error.message}`;\n  });\n}\n\n/**\n * Format validation warnings as a string list\n */\n\nexport function formatWarnings(result: ValidationResult): string[] {\n  return result.warnings.map((warning) => {\n    const pathStr = warning.path.length > 0 ? warning.path.join(\".\") : \"root\";\n    return `[WARNING] ${pathStr}: ${warning.message}`;\n  });\n}\n\n/**\n * Main validation function for Olimpus configuration.\n * Validates an Olimpus configuration against schema and semantic rules.\n * Orchestrates all validation checks and returns aggregated results.\n *\n * Checks performed (when enabled in context):\n * - Circular dependency detection in meta-agent delegation chains\n * - Agent reference validation (all references must be to builtin agents or defined meta-agents)\n * - Regex performance analysis for routing rule patterns (generates warnings only)\n *\n * @param config - The Olimpus configuration to validate\n * @param context - Optional validation context with configuration options\n * @returns ValidationResult with aggregated errors, warnings, and validity status\n */\nexport function validateOlimpusConfig(\n  config: OlimpusConfig,\n  context?: Partial<ValidationContext>,\n): ValidationResult {\n  const ctx: ValidationContext = {\n    checkCircularDependencies: true,\n    checkAgentReferences: true,\n    checkRegexPerformance: true,\n    ...context,\n  };\n\n  const result = createValidationResult(config);\n\n  // Run circular dependency check\n  if (ctx.checkCircularDependencies) {\n    const circularCheck = checkCircularDependenciesInConfig(config, ctx);\n    result.errors.push(...circularCheck.errors);\n  }\n\n  // Run agent reference check\n  if (ctx.checkAgentReferences) {\n    const agentRefCheck = checkAgentReferencesInConfig(config, ctx);\n    result.errors.push(...agentRefCheck.errors);\n  }\n\n  // Run regex performance check (generates warnings, not errors)\n  if (ctx.checkRegexPerformance) {\n    const regexCheck = checkRegexPerformanceInConfig(config, ctx);\n    result.warnings.push(...regexCheck.warnings);\n  }\n\n  // Determine validity based on errors (warnings don't affect validity)\n  result.valid = result.errors.length === 0;\n\n  return result;\n}\n\n/**\n * Builtin agent names that can be delegation targets\n * Re-exported from schema for use in validation\n */\nexport const BUILTIN_AGENT_NAMES = [\n  \"sisyphus\",\n  \"hephaestus\",\n  \"oracle\",\n  \"librarian\",\n  \"explore\",\n  \"multimodal-looker\",\n  \"metis\",\n  \"momus\",\n  \"atlas\",\n  \"prometheus\",\n] as const;\n\n/**\n * Tracks delegation chains to detect circular dependencies\n * Key: \"from:to\", Value: depth level\n */\ninterface DelegationTracker {\n  [key: string]: number;\n}\n\n/**\n * Helper class for circular dependency detection\n * Based on MetaAgentRegistry pattern from src/agents/registry.ts\n */\nclass DelegationGraph {\n  private delegations: DelegationTracker = {};\n  private maxDepth: number;\n\n  constructor(maxDepth: number = 3) {\n    this.maxDepth = maxDepth;\n  }\n\n  /**\n   * Track a delegation from one agent to another\n   * Used for circular dependency detection\n   */\n  trackDelegation(from: string, to: string): void {\n    const key = `${from}:${to}`;\n    this.delegations[key] = (this.delegations[key] ?? 0) + 1;\n  }\n\n  /**\n   * Check if a delegation would create a circular dependency\n   * Returns true if circular, false if safe\n   */\n  checkCircular(\n    from: string,\n    to: string,\n    maxDepth: number = this.maxDepth\n  ): boolean {\n    return this.hasCircle(from, to, maxDepth, new Set());\n  }\n\n  /**\n   * Recursively check for circular paths in delegation chain\n   * @param current - Current agent in the chain\n   * @param target - Target agent we're trying to reach\n   * @param depth - Remaining depth to search\n   * @param visited - Set of visited nodes to detect cycles\n   * @returns true if a circular path exists, false otherwise\n   */\n  private hasCircle(\n    current: string,\n    target: string,\n    depth: number,\n    visited: Set<string>\n  ): boolean {\n    if (depth <= 0) {\n      return false;\n    }\n\n    if (visited.has(current)) {\n      // Already visited this node in this path - potential cycle\n      return true;\n    }\n\n    if (current === target) {\n      // Direct connection found\n      return true;\n    }\n\n    visited.add(current);\n\n    // Check all known delegations from current agent\n    for (const delegation of Object.keys(this.delegations)) {\n      const [from, next] = delegation.split(\":\");\n      if (from === current && next) {\n        if (this.hasCircle(next, target, depth - 1, new Set(visited))) {\n          return true;\n        }\n      }\n    }\n\n    return false;\n  }\n}\n\n/**\n * Check for circular dependencies in meta-agent delegation chains\n * @param metaAgents - Map of meta-agent definitions\n * @param maxDepth - Maximum depth to search for circular dependencies\n * @returns Array of CircularDependencyError for each circular dependency found\n */\nexport function checkCircularDependencies(\n  metaAgents: Record<string, MetaAgentDef>,\n  maxDepth: number = 3\n): CircularDependencyError[] {\n  const errors: CircularDependencyError[] = [];\n\n  if (Object.keys(metaAgents).length === 0) {\n    return errors;\n  }\n\n  const graph = new DelegationGraph(maxDepth);\n\n  // Track all delegations from meta-agents\n  for (const [name, def] of Object.entries(metaAgents)) {\n    // Track delegations from delegates_to field\n    for (const delegate of def.delegates_to) {\n      graph.trackDelegation(name, delegate);\n    }\n\n    // Track delegations from routing_rules target_agent\n    for (const rule of def.routing_rules) {\n      graph.trackDelegation(name, rule.target_agent);\n    }\n  }\n\n  // Check each meta-agent for circular dependencies\n  for (const [name, def] of Object.entries(metaAgents)) {\n    const path: string[] = [];\n\n    // Check delegates_to for circular dependencies\n    for (const delegate of def.delegates_to) {\n      if (graph.checkCircular(delegate, name, maxDepth)) {\n        // Found circular dependency\n        path.push(name, delegate);\n        errors.push(\n          createCircularDependencyError(\n            `Circular dependency detected: \"${name}\" delegates to \"${delegate}\" which can route back to \"${name}\"`,\n            path,\n            [name, delegate]\n          )\n        );\n      }\n    }\n\n    // Check routing_rules for circular dependencies\n    for (const rule of def.routing_rules) {\n      if (graph.checkCircular(rule.target_agent, name, maxDepth)) {\n        // Found circular dependency\n        path.push(name, rule.target_agent);\n        errors.push(\n          createCircularDependencyError(\n            `Circular dependency detected: \"${name}\" can route to \"${rule.target_agent}\" which can route back to \"${name}\"`,\n            path,\n            [name, rule.target_agent]\n          )\n        );\n      }\n    }\n\n    // Check if a meta-agent directly delegates to another meta-agent\n    // This is valid in some cases but worth noting for validation\n    for (const delegate of def.delegates_to) {\n      if (delegate in metaAgents && delegate !== name) {\n        // Meta-agent delegates to another meta-agent\n        // Check for circular dependency\n        if (graph.checkCircular(delegate, name, maxDepth)) {\n          path.push(name, delegate);\n          errors.push(\n            createCircularDependencyError(\n              `Circular dependency detected between meta-agents: \"${name}\" -> \"${delegate}\"`,\n              path,\n              [name, delegate]\n            )\n          );\n        }\n      }\n    }\n  }\n\n  return errors;\n}\n\n/**\n * Helper function to check circular dependencies from validation context\n * @param config - The Olimpus configuration to validate\n * @param context - Optional validation context\n * @returns CheckResult with circular dependency check status\n */\nexport function checkCircularDependenciesInConfig(\n  config: OlimpusConfig,\n  context?: Partial<ValidationContext>\n): CheckResult {\n  const result = createCheckResult(\"circular_dependency\");\n\n  if (!config.meta_agents || Object.keys(config.meta_agents).length === 0) {\n    result.passed = true;\n    return result;\n  }\n\n  const maxDepth = config.settings?.max_delegation_depth ?? 3;\n  const errors = checkCircularDependencies(config.meta_agents, maxDepth);\n\n  if (errors.length > 0) {\n    result.passed = false;\n    result.errors.push(...errors);\n  } else {\n    result.passed = true;\n  }\n\n  return result;\n}\n\n/**\n * Check for invalid agent references in meta-agent definitions\n * Validates that all referenced agents exist in BUILTIN_AGENT_NAMES or as other meta-agents\n * @param metaAgents - Map of meta-agent definitions\n * @returns Array of InvalidAgentReferenceError for each invalid reference found\n */\nexport function checkAgentReferences(\n  metaAgents: Record<string, MetaAgentDef>\n): InvalidAgentReferenceError[] {\n  const errors: InvalidAgentReferenceError[] = [];\n\n  if (Object.keys(metaAgents).length === 0) {\n    return errors;\n  }\n\n  // Build set of all valid agent references\n  // Valid references: builtin agents OR other meta-agents defined in the config\n  const validAgents = new Set<string>([...BUILTIN_AGENT_NAMES, ...Object.keys(metaAgents)]);\n\n  // Check each meta-agent for invalid agent references\n  for (const [agentName, def] of Object.entries(metaAgents)) {\n    // Check delegates_to for invalid references\n    for (const delegate of def.delegates_to) {\n      if (!validAgents.has(delegate)) {\n        errors.push(\n          createInvalidAgentReferenceError(\n            `Invalid agent reference: \"${delegate}\" is not a recognized agent. Valid agents are: ${[...BUILTIN_AGENT_NAMES].join(\", \")}`,\n            [\"meta_agents\", agentName, \"delegates_to\"],\n            delegate\n          )\n        );\n      }\n    }\n\n    // Check routing_rules target_agent for invalid references\n    for (const [ruleIndex, rule] of def.routing_rules.entries()) {\n      if (!validAgents.has(rule.target_agent)) {\n        errors.push(\n          createInvalidAgentReferenceError(\n            `Invalid agent reference: \"${rule.target_agent}\" is not a recognized agent. Valid agents are: ${[...BUILTIN_AGENT_NAMES].join(\", \")}`,\n            [\"meta_agents\", agentName, \"routing_rules\", String(ruleIndex), \"target_agent\"],\n            rule.target_agent\n          )\n        );\n      }\n    }\n  }\n\n  return errors;\n}\n\n/**\n * Helper function to check agent references from validation context\n * @param config - The Olimpus configuration to validate\n * @param context - Optional validation context\n * @returns CheckResult with agent reference check status\n */\nexport function checkAgentReferencesInConfig(\n  config: OlimpusConfig,\n  context?: Partial<ValidationContext>\n): CheckResult {\n  const result = createCheckResult(\"agent_reference\");\n\n  if (!config.meta_agents || Object.keys(config.meta_agents).length === 0) {\n    result.passed = true;\n    return result;\n  }\n\n  const errors = checkAgentReferences(config.meta_agents);\n\n  if (errors.length > 0) {\n    result.passed = false;\n    result.errors.push(...errors);\n  } else {\n    result.passed = true;\n  }\n\n  return result;\n}\n\n/**\n * Result of analyzing a regex pattern for performance issues\n */\ninterface RegexAnalysisResult {\n  hasIssue: boolean;\n  reason: string;\n}\n\n/**\n * Analyze a regex pattern for common performance anti-patterns\n * @param pattern - The regex pattern to analyze\n * @returns RegexAnalysisResult indicating if there are performance issues\n */\nfunction analyzeRegexPattern(pattern: string): RegexAnalysisResult {\n  const complexLookaround = /\\(\\?[=!][^)]*[+*?]\\)|\\(\\?<[=!][^)]*[+*?]\\)/.test(pattern);\n  if (complexLookaround) {\n    return {\n      hasIssue: true,\n      reason: \"Complex lookaheads/lookbehinds with quantifiers can be slow\",\n    };\n  }\n\n  const nestedQuantifiers = /(\\([^)]*[+*?][^)]*\\)[+*?]|([+*?][+*?]))/.test(pattern);\n  if (nestedQuantifiers) {\n    return {\n      hasIssue: true,\n      reason: \"Nested quantifiers can cause catastrophic backtracking\",\n    };\n  }\n\n  const overlappingAlternation = /(\\w+)\\|\\1/.test(pattern);\n  if (overlappingAlternation) {\n    return {\n      hasIssue: true,\n      reason: \"Overlapping alternation can cause inefficient backtracking\",\n    };\n  }\n\n  const unboundedDot = /\\^\\.\\*|\\.\\*\\$|\\.\\*$|\\.\\*\\.\\*/.test(pattern);\n  if (unboundedDot) {\n    return {\n      hasIssue: true,\n      reason: \"Unbounded .* patterns can match excessively and cause performance issues\",\n    };\n  }\n\n  const largeRepetition = /\\[[^\\]]+\\][+*?]*\\{\\d{2,}/.test(pattern);\n  if (largeRepetition) {\n    return {\n      hasIssue: true,\n      reason: \"Large repetition quantifiers can cause excessive backtracking\",\n    };\n  }\n\n  const backreferences = /\\\\\\d/.test(pattern);\n  if (backreferences) {\n    return {\n      hasIssue: true,\n      reason: \"Backreferences prevent efficient regex compilation and can be slow\",\n    };\n  }\n\n  const excessiveAlternations = (pattern.match(/\\|/g) || []).length > 8;\n  if (excessiveAlternations) {\n    return {\n      hasIssue: true,\n      reason: \"Many alternations can cause the regex engine to try many paths\",\n    };\n  }\n\n  return {\n    hasIssue: false,\n    reason: \"\",\n  };\n}\n\n/**\n * Check for regex performance issues in meta-agent routing rules\n * Analyzes regex patterns in matchers for potential performance anti-patterns\n * @param metaAgents - Map of meta-agent definitions\n * @returns Array of RegexPerformanceWarning for each performance issue found\n */\nexport function checkRegexPerformance(\n  metaAgents: Record<string, MetaAgentDef>\n): RegexPerformanceWarning[] {\n  const warnings: RegexPerformanceWarning[] = [];\n\n  if (Object.keys(metaAgents).length === 0) {\n    return warnings;\n  }\n\n  // Check each meta-agent for regex performance issues\n  for (const [agentName, def] of Object.entries(metaAgents)) {\n    // Check routing_rules for regex patterns\n    for (const [ruleIndex, rule] of def.routing_rules.entries()) {\n      if (rule.matcher.type === \"regex\") {\n        const pattern = rule.matcher.pattern;\n        const analysis = analyzeRegexPattern(pattern);\n\n        if (analysis.hasIssue) {\n          warnings.push(\n            createRegexPerformanceWarning(\n              `Regex pattern may cause performance issues: ${analysis.reason}`,\n              [\"meta_agents\", agentName, \"routing_rules\", String(ruleIndex), \"matcher\", \"pattern\"],\n              pattern,\n              analysis.reason\n            )\n          );\n        }\n      }\n    }\n  }\n\n  return warnings;\n}\n\n/**\n * Helper function to check regex performance from validation context\n * @param config - The Olimpus configuration to validate\n * @param context - Optional validation context\n * @returns CheckResult with regex performance check status (always passes, warnings only)\n */\nexport function checkRegexPerformanceInConfig(\n  config: OlimpusConfig,\n  context?: Partial<ValidationContext>\n): CheckResult {\n  const result = createCheckResult(\"regex_performance\");\n\n  if (!config.meta_agents || Object.keys(config.meta_agents).length === 0) {\n    result.passed = true;\n    return result;\n  }\n\n  const warnings = checkRegexPerformance(config.meta_agents);\n\n  if (warnings.length > 0) {\n    // Regex performance issues generate warnings, not errors\n    result.passed = true; // Still passes validation, but with warnings\n    result.warnings.push(...warnings);\n  } else {\n    result.passed = true;\n  }\n\n  return result;\n}\n", "import type {\n  OlimpusConfig,\n  MetaAgentDef,\n  AgentOverride,\n  CategoryConfig,\n} from \"./schema\";\n\n/**\n * Translate OlimpusConfig to oh-my-opencode compatible config format.\n * Extracts only oh-my-opencode passthrough fields (agents, categories, disabled_hooks).\n * Strips olimpus-specific fields (meta_agents, settings, skills).\n * Output is compatible with oh-my-opencode's PluginConfigSchema shape.\n */\nexport function translateToOMOConfig(config: OlimpusConfig): OMOPluginConfig {\n  return {\n    agents: config.agents ?? {},\n    categories: config.categories ?? {},\n    disabled_hooks: config.disabled_hooks ?? [],\n  };\n}\n\n/**\n * Extract Olimpus-specific meta-agent definitions from config.\n * Returns only the meta_agents section (olimpus-specific extension).\n */\nexport function extractMetaAgentDefs(\n  config: OlimpusConfig\n): Record<string, MetaAgentDef> {\n  return config.meta_agents ?? {};\n}\n\n/**\n * OMOPluginConfig represents the oh-my-opencode compatible config shape.\n * This is a subset of OhMyOpenCodeConfig containing only the fields\n * that plugins can set via JSONC config.\n */\nexport interface OMOPluginConfig {\n  agents?: Record<string, AgentOverride>;\n  categories?: Record<string, CategoryConfig>;\n  disabled_hooks?: string[];\n}\n", "import type { PluginInput, Hooks } from \"@opencode-ai/plugin\";\ntype Config = Record<string, unknown>;\nimport OhMyOpenCodePlugin from \"oh-my-opencode\";\nimport {\n  translateToOMOConfig,\n  extractMetaAgentDefs,\n} from \"../config/translator\";\nimport type { OlimpusConfig, MetaAgentDef } from \"../config/schema\";\n\n/**\n * PluginInterface is an alias for the Hooks type returned by plugins.\n * It defines the contract between plugins and the oh-my-opencode framework.\n */\nexport type PluginInterface = Hooks;\n\n/**\n * Create the Olimpus plugin wrapper.\n *\n * This function:\n * 1. Translates OlimpusConfig to OMO-compatible config using translateToOMOConfig()\n * 2. Calls the oh-my-opencode plugin with the input\n * 3. Extracts Olimpus meta-agent definitions\n * 4. Creates Olimpus extension handlers (stub for now, will be populated by Task 6)\n * 5. Merges the base PluginInterface with Olimpus extensions\n * 6. Returns the combined PluginInterface\n *\n * @param input - PluginInput containing client, project, directory, etc.\n * @param config - OlimpusConfig for routing rules and meta-agents\n * @returns Combined PluginInterface with OMO handlers + Olimpus extensions\n */\nexport async function createOlimpusWrapper(\n  input: PluginInput,\n  config: OlimpusConfig\n): Promise<PluginInterface> {\n  // Step 1: Translate to OMO config (extracts agents, categories, disabled_hooks)\n  const omoConfig = translateToOMOConfig(config);\n\n  // Step 2: Call oh-my-opencode plugin to get base handlers\n  const omoPluginInterface = await OhMyOpenCodePlugin(input);\n\n  // Step 3: Extract Olimpus meta-agent definitions\n  const metaAgents = extractMetaAgentDefs(config);\n\n  // Step 4: Create Olimpus extension handlers (stub for now)\n  // Will be populated by Task 6 with factory that converts meta-agents to agent configs\n  const olimpusExtension = createOlimpusExtension(metaAgents, omoConfig);\n\n  // Step 5: Merge base PluginInterface with Olimpus extensions\n  const mergedInterface = mergePluginInterfaces(\n    omoPluginInterface,\n    olimpusExtension\n  );\n\n  // Step 6: Return combined PluginInterface\n  return mergedInterface;\n}\n\n/**\n * Create stub Olimpus extension handlers.\n * This is a placeholder that will be populated with meta-agent factories in Task 6.\n *\n * For now, it returns a minimal extension with a config handler that:\n * - Preserves the OMO config\n * - Prepares for future meta-agent agent-config generation\n *\n * @param metaAgents - Extracted meta-agent definitions\n * @param omoConfig - Translated OMO config\n * @returns Stub PluginInterface for Olimpus extensions\n */\nfunction createOlimpusExtension(\n  metaAgents: Record<string, MetaAgentDef>,\n  omoConfig: any\n): PluginInterface {\n  return {\n    config: async (input: Config) => {\n      // Stub config handler for future meta-agent setup\n      // Task 6 will implement factory that converts meta-agents to agent configs\n      // and calls this handler with the generated config\n    },\n  };\n}\n\n/**\n * Merge two PluginInterfaces into one combined interface.\n *\n * Merge strategy:\n * - Tool handlers: Spread base handlers, then extension handlers (extension overwrites)\n * - Config handler: Chain both (base first, then extension)\n * - Hooks: Chain all handlers (base first, then extension)\n * - Other properties: Extension overwrites base\n *\n * @param base - Base PluginInterface (from oh-my-opencode)\n * @param extension - Extension PluginInterface (from Olimpus)\n * @returns Merged PluginInterface\n */\nexport function mergePluginInterfaces(\n  base: PluginInterface,\n  extension: PluginInterface\n): PluginInterface {\n  const merged: PluginInterface = {};\n\n  // Merge tool handlers (spread both, extension overwrites)\n  if (base.tool || extension.tool) {\n    merged.tool = {\n      ...base.tool,\n      ...extension.tool,\n    };\n  }\n\n  // Chain config handlers (base first, then extension)\n  if (base.config || extension.config) {\n    merged.config = async (input: Config) => {\n      // Execute base config handler\n      if (base.config) {\n        await base.config(input);\n      }\n      // Execute extension config handler\n      if (extension.config) {\n        await extension.config(input);\n      }\n    };\n  }\n\n  // Chain event handlers (base first, then extension)\n  if (base.event || extension.event) {\n    merged.event = async (\n      input: Parameters<NonNullable<typeof base.event>>[0]\n    ) => {\n      if (base.event) {\n        await base.event(input);\n      }\n      if (extension.event) {\n        await extension.event(input);\n      }\n    };\n  }\n\n  // Chain all other hooks (base first, then extension)\n  // These include: chat.message, chat.params, chat.headers, permission.ask, etc.\n  type HookName = keyof PluginInterface;\n  const hookNames: HookName[] = [\n    \"chat.message\",\n    \"chat.params\",\n    \"chat.headers\",\n    \"permission.ask\",\n    \"command.execute.before\",\n    \"tool.execute.before\",\n    \"shell.env\",\n    \"tool.execute.after\",\n    \"experimental.chat.messages.transform\",\n    \"experimental.chat.system.transform\",\n    \"experimental.session.compacting\",\n    \"experimental.text.complete\",\n  ];\n\n  for (const hookName of hookNames) {\n    const baseHook = base[hookName];\n    const extensionHook = extension[hookName];\n\n    if (baseHook || extensionHook) {\n      (merged[hookName] as any) = async (...args: any[]) => {\n        if (baseHook) {\n          await (baseHook as any)(...args);\n        }\n        if (extensionHook) {\n          await (extensionHook as any)(...args);\n        }\n      };\n    }\n  }\n\n  // Copy auth hook (extension overwrites)\n  if (base.auth || extension.auth) {\n    merged.auth = extension.auth ?? base.auth;\n  }\n\n  return merged;\n}\n", "import { existsSync } from \"fs\";\nimport type {\n  Matcher,\n  RoutingRule,\n  KeywordMatcher,\n  ComplexityMatcher,\n  RegexMatcher,\n  ProjectContextMatcher,\n  AlwaysMatcher,\n} from \"../config/schema.js\";\nimport type { RoutingLogger, MatcherEvaluation } from \"./logger.js\";\n\nexport interface RoutingContext {\n  prompt: string;\n  projectDir: string;\n  projectFiles?: string[];\n  projectDeps?: string[];\n}\n\nexport interface ResolvedRoute {\n  target_agent: string;\n  matcher_type?: string;\n  matched_content?: string;\n  config_overrides?: {\n    model?: string;\n    temperature?: number;\n    prompt?: string;\n    variant?: string;\n  };\n}\n\nexport interface RoutingResult {\n  route: ResolvedRoute | null;\n  evaluations: MatcherEvaluation[];\n}\n\n/**\n * Evaluates routing rules in order and returns the first matching route\n * Returns null if no rules match\n */\nexport function evaluateRoutingRules(\n  rules: RoutingRule[],\n  context: RoutingContext,\n  logger?: RoutingLogger\n): ResolvedRoute | null;\nexport function evaluateRoutingRules(\n  rules: RoutingRule[],\n  context: RoutingContext,\n  logger?: RoutingLogger,\n  captureEvaluations?: true\n): RoutingResult;\nexport function evaluateRoutingRules(\n  rules: RoutingRule[],\n  context: RoutingContext,\n  logger?: RoutingLogger,\n  captureEvaluations?: boolean\n): ResolvedRoute | RoutingResult | null {\n  const isDebugMode = logger?.isDebugMode() ?? false;\n  const shouldCapture = captureEvaluations || isDebugMode;\n  const evaluations: MatcherEvaluation[] = [];\n  let firstMatch: ResolvedRoute | null = null;\n\n  for (const rule of rules) {\n    const matched = evaluateMatcher(rule.matcher, context);\n\n    if (shouldCapture) {\n      evaluations.push({\n        matcher_type: rule.matcher.type,\n        matcher: rule.matcher,\n        matched,\n      });\n    }\n\n    if (matched && !firstMatch) {\n      const matchedContent = getMatchedContent(rule.matcher, context);\n      firstMatch = {\n        target_agent: rule.target_agent,\n        matcher_type: rule.matcher.type,\n        matched_content: matchedContent,\n        config_overrides: rule.config_overrides,\n      };\n\n      if (!isDebugMode) {\n        if (logger && logger.isEnabled()) {\n          logger.logRoutingDecision(\n            firstMatch.target_agent,\n            rule.matcher.type,\n            matchedContent,\n            firstMatch.config_overrides,\n            undefined\n          );\n        }\n        if (shouldCapture) {\n          return { route: firstMatch, evaluations };\n        }\n        return firstMatch;\n      }\n    }\n  }\n\n  if (firstMatch && logger && logger.isEnabled()) {\n    logger.logRoutingDecision(\n      firstMatch.target_agent,\n      firstMatch.matcher_type!,\n      firstMatch.matched_content!,\n      firstMatch.config_overrides,\n      isDebugMode ? evaluations : undefined\n    );\n  }\n\n  if (shouldCapture) {\n    return { route: firstMatch, evaluations };\n  }\n  return firstMatch;\n}\n\n/**\n * Extracts the content that triggered the match based on matcher type\n * Returns a human-readable description of what was matched\n */\nfunction getMatchedContent(matcher: Matcher, context: RoutingContext): string {\n  switch (matcher.type) {\n    case \"keyword\": {\n      const promptLower = context.prompt.toLowerCase();\n      const matchedKeywords = matcher.keywords.filter((kw) =>\n        promptLower.includes(kw.toLowerCase())\n      );\n      return `matched keywords: ${matchedKeywords.join(\", \")}`;\n    }\n    case \"regex\":\n      return `matched pattern: /${matcher.pattern}/${matcher.flags || \"\"}`;\n    case \"complexity\":\n      return `complexity score >= ${matcher.threshold}`;\n    case \"project_context\":\n      const fileMatches =\n        matcher.has_files && matcher.has_files.length > 0\n          ? `files: ${matcher.has_files.join(\", \")}`\n          : \"\";\n      const depMatches =\n        matcher.has_deps && matcher.has_deps.length > 0\n          ? `deps: ${matcher.has_deps.join(\", \")}`\n          : \"\";\n      const parts = [fileMatches, depMatches].filter(Boolean);\n      return parts.length > 0 ? parts.join(\"; \") : \"project context match\";\n    case \"always\":\n      return \"always match\";\n    default:\n      const exhaustive: never = matcher;\n      throw new Error(`Unknown matcher type: ${exhaustive}`);\n  }\n}\n\n/**\n * Evaluates a single matcher against the routing context\n * Dispatches to specific matcher evaluators based on matcher type\n */\nexport function evaluateMatcher(\n  matcher: Matcher,\n  context: RoutingContext\n): boolean {\n  switch (matcher.type) {\n    case \"keyword\":\n      return evaluateKeywordMatcher(matcher, context);\n    case \"complexity\":\n      return evaluateComplexityMatcher(matcher, context);\n    case \"regex\":\n      return evaluateRegexMatcher(matcher, context);\n    case \"project_context\":\n      return evaluateProjectContextMatcher(matcher, context);\n    case \"always\":\n      return evaluateAlwaysMatcher(matcher, context);\n    default:\n      const exhaustive: never = matcher;\n      throw new Error(`Unknown matcher type: ${exhaustive}`);\n  }\n}\n\nfunction evaluateKeywordMatcher(\n  matcher: KeywordMatcher,\n  context: RoutingContext\n): boolean {\n  const prompt = context.prompt.toLowerCase();\n  const keywords = matcher.keywords.map((kw) => kw.toLowerCase());\n\n  if (matcher.mode === \"any\") {\n    return keywords.some((kw) => prompt.includes(kw));\n  } else {\n    return keywords.every((kw) => prompt.includes(kw));\n  }\n}\n\nfunction evaluateComplexityMatcher(\n  matcher: ComplexityMatcher,\n  context: RoutingContext\n): boolean {\n  const complexity = calculateComplexity(context.prompt);\n  const thresholdMap: Record<string, number> = {\n    low: 2,\n    medium: 5,\n    high: 10,\n  };\n  const threshold = thresholdMap[matcher.threshold] ?? 0;\n  return complexity >= threshold;\n}\n\nfunction calculateComplexity(prompt: string): number {\n  const lines = prompt.split(\"\\n\").length;\n  let score = Math.ceil(lines / 10);\n\n  const technicalKeywords = [\n    \"architecture\",\n    \"performance\",\n    \"optimization\",\n    \"database\",\n    \"async\",\n    \"concurrent\",\n    \"algorithm\",\n    \"data structure\",\n    \"api\",\n    \"integration\",\n    \"security\",\n    \"encryption\",\n    \"authentication\",\n    \"deployment\",\n    \"infrastructure\",\n    \"testing\",\n    \"refactor\",\n    \"debug\",\n    \"trace\",\n    \"profile\",\n  ];\n\n  const promptLower = prompt.toLowerCase();\n  const keywordCount = technicalKeywords.filter((kw) =>\n    promptLower.includes(kw)\n  ).length;\n\n  score += keywordCount;\n  return score;\n}\n\nfunction evaluateRegexMatcher(\n  matcher: RegexMatcher,\n  context: RoutingContext\n): boolean {\n  try {\n    const regex = new RegExp(matcher.pattern, matcher.flags || \"i\");\n    return regex.test(context.prompt);\n  } catch (error) {\n    console.error(\n      `Invalid regex pattern: ${matcher.pattern}`,\n      error instanceof Error ? error.message : error\n    );\n    return false;\n  }\n}\n\nfunction evaluateProjectContextMatcher(\n  matcher: ProjectContextMatcher,\n  context: RoutingContext\n): boolean {\n  if (matcher.has_files && matcher.has_files.length > 0) {\n    const filesMatch = matcher.has_files.every((filePath) => {\n      const fullPath = `${context.projectDir}/${filePath}`;\n      return existsSync(fullPath);\n    });\n    if (!filesMatch) {\n      return false;\n    }\n  }\n\n  if (matcher.has_deps && matcher.has_deps.length > 0) {\n    const depsMatch = matcher.has_deps.every((dep) => {\n      return context.projectDeps?.includes(dep) ?? false;\n    });\n    if (!depsMatch) {\n      return false;\n    }\n  }\n\n  return true;\n}\n\nfunction evaluateAlwaysMatcher(\n  matcher: AlwaysMatcher,\n  context: RoutingContext\n): boolean {\n  return true;\n}\n", "import type { MetaAgentDef } from \"../config/schema.js\";\nimport { evaluateRoutingRules, type RoutingContext, type ResolvedRoute } from \"./routing.js\";\nimport type { RoutingLogger } from \"./logger.js\";\n\ntype AgentConfig = {\n  model?: string;\n  prompt?: string;\n  temperature?: number;\n  variant?: string;\n};\n\n/**\n * Creates an AgentConfig for a meta-agent by evaluating its routing rules\n * against the provided context\n *\n * @param def - Meta-agent definition with routing rules\n * @param context - Routing context (prompt, projectDir, etc.)\n * @param metaAgentName - Name of the meta-agent\n * @param logger - Optional routing logger for logging routing decisions\n * @returns AgentConfig with delegation instructions, or null if no route matched\n */\nexport function createMetaAgentConfig(\n  def: MetaAgentDef,\n  context: RoutingContext,\n  metaAgentName: string,\n  logger?: RoutingLogger\n): AgentConfig | null {\n  // Evaluate routing rules to find target agent\n  const route = evaluateRoutingRules(def.routing_rules, context, logger) as unknown as ResolvedRoute | null;\n\n  if (!route) {\n    // No route matched - caller should handle this\n    return null;\n  }\n\n  // Build delegation prompt that instructs meta-agent to delegate to target\n  const delegationPrompt = buildDelegationPrompt(\n    metaAgentName,\n    route.target_agent,\n    context.prompt\n  );\n\n  // Determine final model (rule override or default)\n  const model = route.config_overrides?.model || def.base_model;\n\n  // Determine temperature (rule override or default)\n  const temperature = route.config_overrides?.temperature || def.temperature;\n\n  // Build AgentConfig\n  const agentConfig: AgentConfig = {\n    model,\n    prompt: delegationPrompt,\n    ...(temperature !== undefined && { temperature }),\n    ...(route.config_overrides?.variant && {\n      variant: route.config_overrides.variant,\n    }),\n  };\n\n  return agentConfig;\n}\n\n/**\n * Builds a system prompt for a meta-agent that delegates work to another agent\n * using the `task` tool\n *\n * @param metaAgentName - Name of the meta-agent\n * @param targetAgent - Name of the agent to delegate to\n * @param originalPrompt - The user's original request\n * @returns System prompt with delegation instructions\n */\nexport function buildDelegationPrompt(\n  metaAgentName: string,\n  targetAgent: string,\n  originalPrompt: string\n): string {\n  return `You are ${metaAgentName}, a meta-agent coordinator for the Olimpus plugin system.\n\nYour role is to analyze the user's request and delegate it to the appropriate specialized agent.\n\nBased on the user's request, you have determined that this task should be handled by the \"${targetAgent}\" agent.\n\n**User Request:**\n${originalPrompt}\n\n**Your Task:**\n1. Understand the user's request above\n2. Use the \\`task\\` tool to delegate this work to the \"${targetAgent}\" agent\n3. Include the full user request in the task delegation\n4. Return the result from the ${targetAgent} agent to the user\n\nThe task tool accepts:\n- agent: \"${targetAgent}\"\n- prompt: The user's request (pass it through as-is)\n\nDelegate this task now using the available task tool.`;\n}\n", "import type { Matcher, RoutingLoggerConfig } from \"../config/schema.js\";\nimport { dirname } from \"path\";\nimport { mkdirSync, appendFileSync } from \"fs\";\n\nexport interface MatcherEvaluation {\n  matcher_type: string;\n  matcher: Matcher;\n  matched: boolean;\n}\n\nexport interface RoutingLogEntry {\n  timestamp: string;\n  target_agent: string;\n  matcher_type: string;\n  matched_content: string;\n  config_overrides?: {\n    model?: string;\n    temperature?: number;\n    prompt?: string;\n    variant?: string;\n  };\n  debug_info?: {\n    all_evaluated: MatcherEvaluation[];\n    total_evaluated: number;\n  };\n}\n\n/**\n * RoutingLogger class for logging routing decisions\n * Supports console, file, and disabled output modes\n * Includes debug mode for comprehensive evaluation tracking\n */\nexport class RoutingLogger {\n  private config: {\n    enabled: boolean;\n    output: \"console\" | \"file\" | \"disabled\";\n    log_file: string;\n    debug_mode: boolean;\n  };\n  private enabled: boolean;\n\n  constructor(config: RoutingLoggerConfig = {}) {\n    // Apply defaults\n    this.config = {\n      enabled: config.enabled ?? true,\n      output: config.output ?? \"console\",\n      log_file: config.log_file ?? \"routing.log\",\n      debug_mode: config.debug_mode ?? false,\n    };\n\n    // Determine if logging is enabled based on both enabled flag and output mode\n    this.enabled = this.config.enabled && this.config.output !== \"disabled\";\n  }\n\n  /**\n   * Logs a routing decision with structured JSON format\n   * Includes timestamp, matcher type, matched content, and selected agent\n   */\n  logRoutingDecision(\n    targetAgent: string,\n    matcherType: string,\n    matchedContent: string,\n    configOverrides?: {\n      model?: string;\n      temperature?: number;\n      prompt?: string;\n      variant?: string;\n    },\n    allEvaluations?: MatcherEvaluation[],\n  ): void {\n    if (!this.enabled) {\n      return;\n    }\n\n    const entry: RoutingLogEntry = {\n      timestamp: new Date().toISOString(),\n      target_agent: targetAgent,\n      matcher_type: matcherType,\n      matched_content: matchedContent,\n      config_overrides: configOverrides,\n    };\n\n    // Add debug info if debug mode is enabled and evaluations are provided\n    if (this.config.debug_mode && allEvaluations) {\n      entry.debug_info = {\n        all_evaluated: allEvaluations,\n        total_evaluated: allEvaluations.length,\n      };\n    }\n\n    const logLine = JSON.stringify(entry);\n\n    try {\n      switch (this.config.output) {\n        case \"console\":\n          console.log(logLine);\n          break;\n        case \"file\":\n          this.writeToFile(logLine);\n          break;\n        case \"disabled\":\n          // Do nothing\n          break;\n        default:\n          // Invalid output mode - do nothing\n          break;\n      }\n    } catch (error) {\n      // Silently fail to avoid disrupting routing logic\n      // Error is swallowed per performance pattern - minimal overhead\n    }\n  }\n\n  /**\n   * Writes a log line to the configured log file\n   * Appends to existing file with newline separator\n   */\n  private writeToFile(logLine: string): void {\n    try {\n      // Ensure parent directory exists\n      const dir = dirname(this.config.log_file);\n      try {\n        mkdirSync(dir, { recursive: true });\n      } catch {\n        // Directory might already exist, ignore error\n      }\n\n      // Use synchronous file append for immediate write\n      appendFileSync(this.config.log_file, logLine + \"\\n\");\n    } catch (error) {\n      // Silently fail to avoid disrupting routing logic\n      // Error is swallowed per performance pattern - minimal overhead\n    }\n  }\n\n  /**\n   * Checks if logging is currently enabled\n   */\n  isEnabled(): boolean {\n    return this.enabled;\n  }\n\n  /**\n   * Checks if debug mode is enabled\n   */\n  isDebugMode(): boolean {\n    return this.config.debug_mode;\n  }\n}\n", "import type { MetaAgentDef, RoutingLoggerConfig } from \"../config/schema.js\";\nimport type { RoutingContext } from \"./routing.js\";\nimport { createMetaAgentConfig } from \"./meta-agent.js\";\nimport { RoutingLogger } from \"./logger.js\";\nimport type { AgentConfig } from \"@opencode-ai/sdk\";\nimport type { AnalyticsStorage } from \"../analytics/storage.js\";\n\n/**\n * Tracks delegation chains to detect circular dependencies\n * Key: \"from:to\", Value: depth level\n */\ninterface DelegationTracker {\n  [key: string]: number;\n}\n\n/**\n * Registry for meta-agents with delegation tracking and circular dependency detection\n */\nexport class MetaAgentRegistry {\n  private definitions: Map<string, MetaAgentDef> = new Map();\n  private delegations: DelegationTracker = {};\n  private maxDepth: number;\n  private logger?: RoutingLogger;\n  private analyticsStorage?: AnalyticsStorage;\n\n  constructor(\n    maxDepth: number = 3,\n    loggerConfig?: RoutingLoggerConfig,\n    analyticsStorage?: AnalyticsStorage,\n  ) {\n    this.maxDepth = maxDepth;\n    this.analyticsStorage = analyticsStorage;\n    if (loggerConfig) {\n      this.logger = new RoutingLogger(loggerConfig);\n    }\n  }\n\n  /**\n   * Register a meta-agent definition\n   */\n  register(name: string, def: MetaAgentDef): void {\n    this.definitions.set(name, def);\n  }\n\n  /**\n   * Get all registered meta-agent definitions\n   */\n  getAll(): Record<string, MetaAgentDef> {\n    const result: Record<string, MetaAgentDef> = {};\n    for (const [name, def] of this.definitions.entries()) {\n      result[name] = def;\n    }\n    return result;\n  }\n\n  /**\n   * Resolve a meta-agent to its AgentConfig by evaluating routing rules\n   * Returns null if no route matches\n   */\n  resolve(name: string, context: RoutingContext): AgentConfig | null {\n    const def = this.definitions.get(name);\n    if (!def) {\n      throw new Error(`Meta-agent \"${name}\" not registered`);\n    }\n\n    return createMetaAgentConfig(def, context, name, this.logger);\n  }\n\n  /**\n   * Track a delegation from one agent to another\n   * Used for circular dependency detection\n   */\n  trackDelegation(from: string, to: string): void {\n    const key = `${from}:${to}`;\n    this.delegations[key] = (this.delegations[key] ?? 0) + 1;\n  }\n\n  /**\n   * Check if a delegation would create a circular dependency\n   * Returns true if circular, false if safe\n   */\n  checkCircular(\n    from: string,\n    to: string,\n    maxDepth: number = this.maxDepth,\n  ): boolean {\n    return this.hasCircle(from, to, maxDepth, new Set());\n  }\n\n  /**\n   * Recursively check for circular paths in delegation chain\n   * @param current - Current agent in the chain\n   * @param target - Target agent we're trying to reach\n   * @param depth - Remaining depth to search\n   * @param visited - Set of visited nodes to detect cycles\n   * @returns true if a circular path exists, false otherwise\n   */\n  private hasCircle(\n    current: string,\n    target: string,\n    depth: number,\n    visited: Set<string>,\n  ): boolean {\n    if (depth <= 0) {\n      return false;\n    }\n\n    if (visited.has(current)) {\n      // Already visited this node in this path - potential cycle\n      return true;\n    }\n\n    if (current === target) {\n      // Direct connection found\n      return true;\n    }\n\n    visited.add(current);\n\n    // Check all known delegations from current agent\n    for (const [delegation, _count] of Object.entries(this.delegations)) {\n      const [from, next] = delegation.split(\":\");\n      if (from === current && next) {\n        if (this.hasCircle(next, target, depth - 1, new Set(visited))) {\n          return true;\n        }\n      }\n    }\n\n    return false;\n  }\n\n  /**\n   * Get current delegation depth (longest chain tracked)\n   */\n  getMaxTrackedDepth(): number {\n    let maxDepth = 0;\n\n    for (const delegation of Object.keys(this.delegations)) {\n      const parts = delegation.split(\":\");\n      if (parts.length === 2) {\n        // Count how many hops from this starting point\n        let depth = 1;\n        let current = parts[1];\n\n        while (true) {\n          let found = false;\n          for (const next of Object.keys(this.delegations)) {\n            const [from, to] = next.split(\":\");\n            if (from === current) {\n              depth++;\n              current = to;\n              found = true;\n              break;\n            }\n          }\n          if (!found) break;\n        }\n\n        maxDepth = Math.max(maxDepth, depth);\n      }\n    }\n\n    return maxDepth;\n  }\n}\n", "import type { MetaAgentDef } from \"../../config/schema.js\";\n\n/**\n * Atenea - Primary Orchestrator Meta-Agent\n * Central coordinator routing requests to internal Olympus agents (via their routing patterns)\n * and Oh my OpenCode builtin agents. Routes based on: Jira keywords \u2192 research agents,\n * framework patterns \u2192 validation agents, complexity \u2192 strategic agents.\n * Always falls back to metis for general analysis\n */\nexport const ateneo: MetaAgentDef = {\n  base_model: \"\", // Uses default from config\n  delegates_to: [\n    \"librarian\",\n    \"explore\",\n    \"oracle\",\n    \"sisyphus\",\n    \"hephaestus\",\n    \"prometheus\",\n    \"atlas\",\n    \"metis\",\n  ],\n  routing_rules: [\n    // Jira-related routing (coordinated with Hermes patterns)\n    {\n      matcher: {\n        type: \"keyword\",\n        keywords: [\"jira\", \"ticket\", \"task\", \"subtask\", \"story\", \"issue\", \"sprint\", \"backlog\"],\n        mode: \"any\",\n      },\n      target_agent: \"librarian\",\n      config_overrides: {\n        prompt:\n          \"You are a Jira lifecycle research specialist. Search for relevant documentation, existing tickets, related issues, and project context to support this Jira-related request. Consider ticket states, workflow transitions, and integration requirements.\",\n      },\n    },\n    // Framework modification routing (coordinated with Hades patterns)\n    {\n      matcher: {\n        type: \"project_context\",\n        has_files: [\"src/config/\", \"src/agents/\", \"src/plugin/\"],\n      },\n      target_agent: \"oracle\",\n      config_overrides: {\n        prompt:\n          \"You are a framework validation strategist. Analyze this framework modification considering: impact on existing features, workflow disruptions, agent delegation chains, and configuration consistency. Recommend safe implementation approaches.\",\n      },\n    },\n    {\n      matcher: {\n        type: \"keyword\",\n        keywords: [\n          \"framework\",\n          \"validation\",\n          \"config\",\n          \"schema\",\n          \"agent definition\",\n          \"routing rule\",\n          \"registry\",\n        ],\n        mode: \"any\",\n      },\n      target_agent: \"oracle\",\n      config_overrides: {\n        prompt:\n          \"You are a framework coherence analyst. Evaluate this framework-related request for: backward compatibility, impact on existing agents, routing integrity, and configuration stability.\",\n      },\n    },\n    // Complexity-based strategic routing\n    {\n      matcher: {\n        type: \"complexity\",\n        threshold: \"high\",\n      },\n      target_agent: \"oracle\",\n      config_overrides: {\n        prompt:\n          \"You are a strategic architecture advisor. Analyze this complex problem from first principles, considering system design patterns, scalability, maintainability, and long-term implications.\",\n      },\n    },\n    {\n      matcher: {\n        type: \"complexity\",\n        threshold: \"medium\",\n      },\n      target_agent: \"prometheus\",\n      config_overrides: {\n        prompt:\n          \"You are a technical strategist. Analyze this problem considering trade-offs, patterns, and best practices. Focus on pragmatic solutions aligned with industry standards.\",\n      },\n    },\n    {\n      matcher: {\n        type: \"complexity\",\n        threshold: \"low\",\n      },\n      target_agent: \"atlas\",\n      config_overrides: {\n        prompt:\n          \"You are a technical advisor. Provide clear analysis and guidance on this straightforward technical question.\",\n      },\n    },\n    // Always fallback for general analysis\n    {\n      matcher: {\n        type: \"always\",\n      },\n      target_agent: \"metis\",\n      config_overrides: {\n        prompt:\n          \"You are a general technical analyst. Synthesize information and provide comprehensive strategic analysis.\",\n      },\n    },\n  ],\n  prompt_template:\n    \"Analyze this strategic and architectural question: {input}\\n\\nProvide analysis considering:\\n- System design principles\\n- Scalability and performance\\n- Maintainability and technical debt\\n- Trade-offs and alternatives\",\n};\n", "import type { MetaAgentDef } from \"../../config/schema.js\";\n\n/**\n * Hermes - Communication & Research Meta-Agent\n * Handles information gathering, documentation research, and synthesis\n * Routes based on keywords: docs/search \u2192 librarian, code/find \u2192 explore, analyze/review \u2192 oracle\n * Also handles Jira lifecycle management: tickets, tasks, subtasks, user stories\n * Always falls back to librarian for general research\n */\nexport const hermes: MetaAgentDef = {\n  base_model: \"\",\n  delegates_to: [\"librarian\", \"explore\", \"oracle\"],\n  routing_rules: [\n    {\n      matcher: {\n        type: \"keyword\",\n        keywords: [\n          \"jira\",\n          \"ticket\",\n          \"task\",\n          \"subtask\",\n          \"story\",\n          \"issue\",\n          \"sprint\",\n          \"backlog\",\n          \"epic\",\n        ],\n        mode: \"any\",\n      },\n      target_agent: \"librarian\",\n      config_overrides: {\n        prompt:\n          \"You are a Jira lifecycle management specialist. Research and gather information about Jira tickets, tasks, subtasks, user stories, epics, and sprints. Use available Jira API tools to fetch, search, or analyze Jira issues and projects.\",\n      },\n    },\n    {\n      matcher: {\n        type: \"keyword\",\n        keywords: [\"docs\", \"documentation\", \"guide\", \"search\", \"lookup\"],\n        mode: \"any\",\n      },\n      target_agent: \"librarian\",\n      config_overrides: {\n        prompt:\n          \"You are a research specialist focused on finding and synthesizing documentation. Search comprehensively for relevant documentation, guides, and examples.\",\n      },\n    },\n    {\n      matcher: {\n        type: \"keyword\",\n        keywords: [\"code\", \"find\", \"search\", \"locate\", \"where is\"],\n        mode: \"any\",\n      },\n      target_agent: \"explore\",\n      config_overrides: {\n        prompt:\n          \"You are a code explorer. Search the codebase comprehensively to find relevant code, patterns, and implementations.\",\n      },\n    },\n    {\n      matcher: {\n        type: \"keyword\",\n        keywords: [\"analyze\", \"review\", \"compare\", \"evaluate\", \"assess\"],\n        mode: \"any\",\n      },\n      target_agent: \"oracle\",\n      config_overrides: {\n        prompt:\n          \"You are a comprehensive analyst. Review and analyze the gathered information, providing deep insights and comparisons.\",\n      },\n    },\n    {\n      matcher: {\n        type: \"always\",\n      },\n      target_agent: \"librarian\",\n      config_overrides: {\n        prompt:\n          \"You are a research specialist. Gather relevant information from available sources and synthesize it into a coherent answer.\",\n      },\n    },\n  ],\n  prompt_template:\n    \"Research and gather information on: {input}\\n\\nProvide:\\n- Relevant documentation and resources\\n- Current best practices\\n- Practical examples\\n- Synthesis of findings\",\n};\n", "import type { MetaAgentDef } from \"../../config/schema.js\";\n\n/**\n * Hades - Framework Validation Meta-Agent\n * Ensures modifications to the Olympus framework maintain coherence with existing features\n * Routes based on framework file patterns: config/schema \u2192 oracle, agents/definitions \u2192 sisyphus, plugin \u2192 hephaestus\n * Always falls back to hephaestus for building\n */\nexport const hades: MetaAgentDef = {\n  base_model: \"\",\n  delegates_to: [\"oracle\", \"sisyphus\", \"hephaestus\"],\n  routing_rules: [\n    {\n      matcher: {\n        type: \"regex\",\n        pattern: \"src/config/.*\\\\.ts\",\n      },\n      target_agent: \"oracle\",\n      config_overrides: {\n        prompt:\n          \"You are a framework validation specialist. Analyze this configuration change carefully, considering impacts on: existing schemas, agent definitions, routing rules, and plugin behavior. Ensure backward compatibility and validate that changes don't break existing workflows.\",\n        variant: \"validation\",\n      },\n    },\n    {\n      matcher: {\n        type: \"regex\",\n        pattern: \"src/agents/.*\\\\.ts\",\n      },\n      target_agent: \"sisyphus\",\n      config_overrides: {\n        prompt:\n          \"You are a framework agent specialist. Modify agent definitions with care, ensuring routing rules remain valid, delegation targets exist, and matcher logic is correct. Test changes thoroughly and verify no circular delegation is introduced.\",\n        variant: \"validation\",\n      },\n    },\n    {\n      matcher: {\n        type: \"regex\",\n        pattern: \"src/plugin/.*\\\\.ts\",\n      },\n      target_agent: \"hephaestus\",\n      config_overrides: {\n        prompt:\n          \"You are a plugin infrastructure specialist. Implement plugin changes with attention to: lifecycle hooks, error handling, registration patterns, and integration points. Ensure changes maintain plugin compatibility.\",\n        variant: \"validation\",\n      },\n    },\n    {\n      matcher: {\n        type: \"keyword\",\n        keywords: [\n          \"config\",\n          \"schema\",\n          \"agent\",\n          \"routing\",\n          \"definition\",\n          \"plugin\",\n          \"framework\",\n          \"validation\",\n          \"registry\",\n        ],\n        mode: \"any\",\n      },\n      target_agent: \"oracle\",\n      config_overrides: {\n        prompt:\n          \"You are a framework coherence analyst. Analyze this framework-related change considering: impacts on existing features, workflow disruptions, agent delegation chains, and configuration consistency. Provide recommendations for safe implementation.\",\n      },\n    },\n    {\n      matcher: {\n        type: \"always\",\n      },\n      target_agent: \"hephaestus\",\n      config_overrides: {\n        prompt:\n          \"You are a framework builder. Implement this change with careful attention to maintaining framework stability, backward compatibility, and proper integration with existing systems.\",\n      },\n    },\n  ],\n  prompt_template:\n    \"Validate and implement this framework modification: {input}\\n\\nConsider:\\n- Impact on existing features and workflows\\n- Backward compatibility\\n- Agent delegation chains\\n- Configuration consistency\\n- Error handling and edge cases\",\n};\n", "import { existsSync, readFileSync } from \"fs\";\nimport { resolve, extname } from \"path\";\nimport type {\n  SkillDefinition,\n  SkillMetadata,\n  CommandDefinition,\n} from \"./types.js\";\n\nconst FRONTMATTER_DELIMITER = \"---\";\nconst OLIMPUS_PREFIX = \"olimpus:\";\n\nfunction parseFrontmatter(content: string): {\n  metadata: SkillMetadata;\n  template: string;\n} {\n  const lines = content.split(\"\\n\");\n\n  if (lines[0]?.trim() !== FRONTMATTER_DELIMITER) {\n    return {\n      metadata: {},\n      template: content,\n    };\n  }\n\n  let endDelimiterIdx = -1;\n  for (let i = 1; i < lines.length; i++) {\n    if (lines[i]?.trim() === FRONTMATTER_DELIMITER) {\n      endDelimiterIdx = i;\n      break;\n    }\n  }\n\n  if (endDelimiterIdx === -1) {\n    return {\n      metadata: {},\n      template: content,\n    };\n  }\n\n  const frontmatterLines = lines.slice(1, endDelimiterIdx);\n  const metadata = parseFrontmatterLines(frontmatterLines);\n\n  const template = lines\n    .slice(endDelimiterIdx + 1)\n    .join(\"\\n\")\n    .trim();\n\n  return { metadata, template };\n}\n\nfunction parseFrontmatterLines(lines: string[]): SkillMetadata {\n  const metadata: SkillMetadata = {};\n\n  for (const line of lines) {\n    const trimmed = line.trim();\n    if (!trimmed || trimmed.startsWith(\"#\")) {\n      continue;\n    }\n\n    const colonIdx = trimmed.indexOf(\":\");\n    if (colonIdx === -1) {\n      continue;\n    }\n\n    const key = trimmed.substring(0, colonIdx).trim();\n    const value = trimmed.substring(colonIdx + 1).trim();\n\n    (metadata as Record<string, string | boolean | string[]>)[key] =\n      parseYamlValue(value);\n  }\n\n  return metadata;\n}\n\nfunction parseYamlValue(value: string): string | boolean | string[] {\n  if (value === \"true\") return true;\n  if (value === \"false\") return false;\n\n  if (value.startsWith(\"[\") && value.endsWith(\"]\")) {\n    const items = value\n      .slice(1, -1)\n      .split(\",\")\n      .map((item) => {\n        const trimmed = item.trim();\n        if (\n          (trimmed.startsWith('\"') && trimmed.endsWith('\"')) ||\n          (trimmed.startsWith(\"'\") && trimmed.endsWith(\"'\"))\n        ) {\n          return trimmed.slice(1, -1);\n        }\n        return trimmed;\n      });\n    return items.filter((item) => item.length > 0);\n  }\n\n  if (\n    (value.startsWith('\"') && value.endsWith('\"')) ||\n    (value.startsWith(\"'\") && value.endsWith(\"'\"))\n  ) {\n    return value.slice(1, -1);\n  }\n\n  return value;\n}\n\nfunction extractSkillName(filePath: string): string {\n  const fileName = filePath.split(\"/\").pop() || \"\";\n  return fileName.replace(/\\.[^.]+$/, \"\");\n}\n\n/**\n * Load Olimpus skills from specified paths\n * Reads markdown files and parses frontmatter + template\n * Returns array of SkillDefinitions with olimpus: prefix applied\n */\nexport function loadOlimpusSkills(\n  skillPaths: string[],\n  projectDir: string\n): SkillDefinition[] {\n  const skills: SkillDefinition[] = [];\n\n  for (const skillPath of skillPaths) {\n    const resolvedPath = skillPath.startsWith(\"/\")\n      ? skillPath\n      : resolve(projectDir, skillPath);\n\n    if (!existsSync(resolvedPath)) {\n      console.warn(`Skill file not found: ${resolvedPath}`);\n      continue;\n    }\n\n    if (extname(resolvedPath) !== \".md\") {\n      console.warn(`Skipping non-markdown file: ${resolvedPath}`);\n      continue;\n    }\n\n    try {\n      const content = readFileSync(resolvedPath, \"utf-8\");\n      const { metadata, template } = parseFrontmatter(content);\n\n      const baseName = extractSkillName(resolvedPath);\n      const skillName = `${OLIMPUS_PREFIX}${baseName}`;\n\n      const definition: CommandDefinition = {\n        name: skillName,\n        description: metadata.description,\n        template,\n        agent: metadata.agent,\n        model: metadata.model,\n        subtask: metadata.subtask,\n        argumentHint: metadata[\"argument-hint\"]\n          ? String(metadata[\"argument-hint\"])\n          : undefined,\n      };\n\n      let allowedTools: string[] | undefined;\n      if (metadata[\"allowed-tools\"]) {\n        allowedTools = Array.isArray(metadata[\"allowed-tools\"])\n          ? metadata[\"allowed-tools\"]\n          : String(metadata[\"allowed-tools\"])\n              .split(\",\")\n              .map((t) => t.trim());\n      }\n\n      const skill: SkillDefinition = {\n        name: skillName,\n        path: skillPath,\n        resolvedPath,\n        definition,\n        scope: \"olimpus\",\n        license: metadata.license ? String(metadata.license) : undefined,\n        compatibility: metadata.compatibility\n          ? String(metadata.compatibility)\n          : undefined,\n        metadata: metadata.metadata,\n        allowedTools,\n      };\n\n      skills.push(skill);\n    } catch (error) {\n      console.error(\n        `Error loading skill from ${resolvedPath}:`,\n        error instanceof Error ? error.message : String(error)\n      );\n      continue;\n    }\n  }\n\n  return skills;\n}\n\n/**\n * Merge base skills (from oh-my-opencode) with Olimpus skills\n * Olimpus skills use olimpus: prefix to avoid naming conflicts\n * Olimpus skills are appended (do not overwrite base skills)\n */\nexport function mergeSkills(\n  baseSkills: SkillDefinition[],\n  olimpusSkills: SkillDefinition[]\n): SkillDefinition[] {\n  const baseNames = new Set(baseSkills.map((s) => s.name));\n\n  const uniqueOlimpusSkills = olimpusSkills.filter(\n    (skill) => !baseNames.has(skill.name)\n  );\n\n  return [...baseSkills, ...uniqueOlimpusSkills];\n}\n", "import type { AnalyticsEvent, AnalyticsConfig } from \"./types.js\";\nimport { dirname } from \"path\";\nimport { mkdirSync, existsSync } from \"fs\";\n\nconst CURRENT_VERSION = \"1.0.0\";\n\n/**\n * AnalyticsData interface for the storage file format\n * Includes events, metrics, and metadata\n */\nexport interface AnalyticsData {\n  events: AnalyticsEvent[];\n  agent_metrics: Record<string, unknown>;\n  matcher_metrics: Record<string, unknown>;\n  total_events: number;\n  first_event_timestamp?: string;\n  last_event_timestamp?: string;\n  version: string;\n}\n\n/**\n * AnalyticsStorage class for persistent storage of analytics data\n * Stores events to a JSON file with configurable retention and max events\n * Supports pruning old events based on retention policy\n */\nexport class AnalyticsStorage {\n  private config: Required<AnalyticsConfig>;\n  private enabled: boolean;\n  private storageFilePath: string;\n  private inMemoryEvents: AnalyticsEvent[] = [];\n\n  constructor(config: AnalyticsConfig = {} as AnalyticsConfig) {\n    // Apply defaults\n    this.config = {\n      enabled: config.enabled ?? true,\n      storage_file: config.storage_file ?? \"analytics.json\",\n      max_events: config.max_events ?? 10000,\n      retention_days: config.retention_days ?? 90,\n      auto_prune: config.auto_prune ?? true,\n    };\n\n    // Determine if storage is enabled\n    this.enabled = this.config.enabled;\n    this.storageFilePath = this.config.storage_file;\n\n    // Load existing data on initialization\n    this.loadFromFile();\n  }\n\n  /**\n   * Records an analytics event to storage\n   * Triggers automatic pruning if enabled\n   */\n  recordEvent(event: AnalyticsEvent): void {\n    if (!this.enabled) {\n      return;\n    }\n\n    try {\n      // Add event to in-memory list\n      this.inMemoryEvents.push(event);\n\n      // Auto-prune if enabled\n      if (this.config.auto_prune) {\n        this.pruneEvents();\n      }\n\n      // Write to file\n      this.saveToFile();\n    } catch (error: unknown) {\n      // Log error but don't disrupt routing logic\n      // This ensures analytics failures don't impact agent selection\n      const message = error instanceof Error ? error.message : String(error);\n      console.error(`[Analytics] Failed to record event: ${message}`);\n    }\n  }\n\n  /**\n   * Retrieves all stored events\n   */\n  getAllEvents(): AnalyticsEvent[] {\n    if (!this.enabled) {\n      return [];\n    }\n\n    return [...this.inMemoryEvents];\n  }\n\n  /**\n   * Retrieves events within a date range\n   */\n  getEventsByDateRange(startDate: Date, endDate: Date): AnalyticsEvent[] {\n    if (!this.enabled) {\n      return [];\n    }\n\n    const start = startDate.getTime();\n    const end = endDate.getTime();\n\n    return this.inMemoryEvents.filter((event) => {\n      const eventTime = new Date(event.timestamp).getTime();\n      return eventTime >= start && eventTime <= end;\n    });\n  }\n\n  /**\n   * Retrieves events for a specific agent\n   */\n  getEventsByAgent(agentName: string): AnalyticsEvent[] {\n    if (!this.enabled) {\n      return [];\n    }\n\n    return this.inMemoryEvents.filter((event) => {\n      return (\n        event.type === \"routing_decision\" && event.target_agent === agentName\n      );\n    });\n  }\n\n  /**\n   * Retrieves events for a specific matcher type\n   */\n  getEventsByMatcherType(matcherType: string): AnalyticsEvent[] {\n    if (!this.enabled) {\n      return [];\n    }\n\n    return this.inMemoryEvents.filter((event) => {\n      return (\n        event.type === \"routing_decision\" && event.matcher_type === matcherType\n      );\n    });\n  }\n\n  /**\n   * Retrieves unmatched request events\n   */\n  getUnmatchedRequests(): AnalyticsEvent[] {\n    if (!this.enabled) {\n      return [];\n    }\n\n    return this.inMemoryEvents.filter((event) => {\n      return event.type === \"unmatched_request\";\n    });\n  }\n\n  /**\n   * Returns the total count of stored events\n   */\n  getEventCount(): number {\n    if (!this.enabled) {\n      return 0;\n    }\n\n    return this.inMemoryEvents.length;\n  }\n\n  /**\n   * Prunes events based on retention days and max_events limit\n   * Removes events older than retention_days\n   * Removes excess events if count exceeds max_events\n   */\n  pruneEvents(): void {\n    if (!this.enabled || this.inMemoryEvents.length === 0) {\n      return;\n    }\n\n    const now = Date.now();\n    const retentionMs = this.config.retention_days * 24 * 60 * 60 * 1000;\n    const retentionThreshold = now - retentionMs;\n\n    // Filter out events older than retention period\n    const afterRetention = this.inMemoryEvents.filter((event) => {\n      const eventTime = new Date(event.timestamp).getTime();\n      return eventTime >= retentionThreshold;\n    });\n\n    // If still too many events, remove oldest ones\n    if (afterRetention.length > this.config.max_events) {\n      const excessCount = afterRetention.length - this.config.max_events;\n      afterRetention.splice(0, excessCount);\n    }\n\n    this.inMemoryEvents = afterRetention;\n  }\n\n  /**\n   * Clears all stored events\n   */\n  clear(): void {\n    if (!this.enabled) {\n      return;\n    }\n\n    try {\n      this.inMemoryEvents = [];\n      this.saveToFile();\n    } catch {\n      // Silently fail to avoid disrupting routing logic\n    }\n  }\n\n  /**\n   * Exports all data in AnalyticsData format\n   */\n  exportData(): AnalyticsData {\n    const now = new Date().toISOString();\n\n    // Sort events by timestamp\n    const sortedEvents = [...this.inMemoryEvents].sort((a, b) =>\n      a.timestamp.localeCompare(b.timestamp),\n    );\n\n    const firstTimestamp =\n      sortedEvents.length > 0 ? sortedEvents[0].timestamp : undefined;\n    const lastTimestamp =\n      sortedEvents.length > 0\n        ? sortedEvents[sortedEvents.length - 1].timestamp\n        : undefined;\n\n    return {\n      events: sortedEvents,\n      agent_metrics: {},\n      matcher_metrics: {},\n      total_events: sortedEvents.length,\n      first_event_timestamp: firstTimestamp,\n      last_event_timestamp: lastTimestamp,\n      version: CURRENT_VERSION,\n    };\n  }\n\n  /**\n   * Checks if storage is enabled\n   */\n  isEnabled(): boolean {\n    return this.enabled;\n  }\n\n  /**\n   * Loads events from the storage file\n   * Populates in-memory cache with existing data\n   */\n  private loadFromFile(): void {\n    if (!this.enabled) {\n      return;\n    }\n\n    try {\n      const fileExists = existsSync(this.storageFilePath);\n      if (!fileExists) {\n        // No existing file, start with empty data\n        this.inMemoryEvents = [];\n        return;\n      }\n\n      // Read file using Bun.file\n      const file = Bun.file(this.storageFilePath);\n      const content = file.text();\n\n      // Parse JSON\n      const data = JSON.parse(content) as AnalyticsData;\n\n      // Extract events from stored data\n      if (Array.isArray(data.events)) {\n        this.inMemoryEvents = data.events;\n      } else {\n        this.inMemoryEvents = [];\n      }\n\n      // Auto-prune on load if enabled\n      if (this.config.auto_prune) {\n        this.pruneEvents();\n      }\n    } catch {\n      // If file doesn't exist or is invalid, start fresh\n      this.inMemoryEvents = [];\n    }\n  }\n\n  /**\n   * Saves current events to the storage file\n   * Writes in AnalyticsData format with metadata\n   */\n  private saveToFile(): void {\n    if (!this.enabled) {\n      return;\n    }\n\n    try {\n      // Ensure parent directory exists\n      const dir = dirname(this.storageFilePath);\n      try {\n        mkdirSync(dir, { recursive: true });\n      } catch {\n        // Directory might already exist, ignore error\n      }\n\n      // Export data and write to file\n      const data = this.exportData();\n      const json = JSON.stringify(data, null, 2);\n      Bun.write(this.storageFilePath, json);\n    } catch {\n      // Silently fail to avoid disrupting routing logic\n      // Error is swallowed per performance pattern - minimal overhead\n    }\n  }\n}\n", "import type { Plugin, PluginInput } from \"@opencode-ai/plugin\";\nimport type { Config } from \"@opencode-ai/sdk\";\nimport { loadOlimpusConfig } from \"./config/loader.js\";\nimport { extractMetaAgentDefs } from \"./config/translator.js\";\nimport {\n  createOlimpusWrapper,\n  type PluginInterface,\n} from \"./plugin/wrapper.js\";\nimport { MetaAgentRegistry } from \"./agents/registry.js\";\nimport { ateneo, hermes, hades } from \"./agents/definitions/index.js\";\nimport { loadOlimpusSkills } from \"./skills/loader.js\";\nimport { AnalyticsStorage } from \"./analytics/storage.js\";\nimport { join } from \"path\";\n\n/**\n * OlimpusPlugin - Meta-orchestrator plugin for OpenCode\n *\n * Execution flow:\n * 1. Load olimpus.jsonc from project directory\n * 2. Create MetaAgentRegistry and register all meta-agents (built-in + config)\n * 3. Call createOlimpusWrapper() to get merged PluginInterface\n * 4. Enhance config handler to register meta-agent AgentConfigs\n * 5. Load and merge Olimpus skills if configured\n * 6. Return final PluginInterface\n *\n * Error handling:\n * - If olimpus.jsonc not found: logs warning, falls through to oh-my-opencode defaults\n * - If oh-my-opencode fails: throws with helpful message\n */\nconst OlimpusPlugin: Plugin = async (input: PluginInput) => {\n  let config;\n\n  try {\n    config = await loadOlimpusConfig(input.directory);\n  } catch (error) {\n    throw new Error(\n      `[Olimpus] Failed to load olimpus.jsonc: ${\n        error instanceof Error ? error.message : String(error)\n      }`,\n    );\n  }\n\n  const maxDepth = config.settings?.max_delegation_depth ?? 3;\n  const loggerConfig = config.settings?.routing_logger;\n\n  // Initialize AnalyticsStorage when analytics is enabled\n  let analyticsStorage: AnalyticsStorage | undefined;\n  const analyticsConfig = config.settings?.routing_logger?.analytics_config;\n  if (analyticsConfig?.enabled) {\n    const storageFile = analyticsConfig.storage_file\n      ? join(input.directory, analyticsConfig.storage_file)\n      : join(input.directory, \"analytics.json\");\n\n    analyticsStorage = new AnalyticsStorage({\n      enabled: true,\n      storage_file: storageFile,\n      max_events: analyticsConfig.max_events ?? 10000,\n      retention_days: analyticsConfig.retention_days ?? 90,\n      auto_prune: analyticsConfig.auto_prune ?? true,\n    });\n  }\n\n  const registry = new MetaAgentRegistry(maxDepth, loggerConfig, analyticsStorage);\n\n  const configMetaAgents = extractMetaAgentDefs(config);\n  for (const [name, def] of Object.entries(configMetaAgents)) {\n    registry.register(name, def);\n  }\n\n  const builtInMetaAgents = [\n    { name: \"olimpus:atenea\", def: ateneo },\n    { name: \"olimpus:hermes\", def: hermes },\n    { name: \"olimpus:hades\", def: hades },\n  ];\n\n  for (const { name, def } of builtInMetaAgents) {\n    if (!configMetaAgents[name]) {\n      registry.register(name, def);\n    }\n  }\n\n  let pluginInterface: PluginInterface;\n  try {\n    pluginInterface = await createOlimpusWrapper(input, config);\n  } catch (error) {\n    throw new Error(\n      `[Olimpus] Failed to initialize oh-my-opencode wrapper: ${\n        error instanceof Error ? error.message : String(error)\n      }`,\n    );\n  }\n\n  const baseConfigHandler = pluginInterface.config;\n  const namespace = config.settings?.namespace_prefix ?? \"olimpus\";\n\n  pluginInterface.config = async (configInput: Config) => {\n    if (baseConfigHandler) {\n      await baseConfigHandler(configInput);\n    }\n\n    const routingContext = {\n      prompt: \"\",\n      projectDir: input.directory,\n      projectFiles: [],\n      projectDeps: [],\n    };\n\n    const allMetaAgents = registry.getAll();\n    for (const [agentName] of Object.entries(allMetaAgents)) {\n      const agentConfig = registry.resolve(agentName, routingContext);\n      if (agentConfig && configInput.agent) {\n        configInput.agent[agentName] = agentConfig;\n      }\n    }\n  };\n\n  if (config.skills && config.skills.length > 0) {\n    try {\n      const olimpusSkills = loadOlimpusSkills(config.skills, input.directory);\n      if (olimpusSkills.length > 0) {\n        console.log(\n          `[Olimpus] Loaded ${olimpusSkills.length} Olimpus skills with ${namespace}: prefix`,\n        );\n      }\n    } catch (error) {\n      console.warn(\n        `[Olimpus] Failed to load skills: ${\n          error instanceof Error ? error.message : String(error)\n        }`,\n      );\n    }\n  }\n\n  return pluginInterface;\n};\n\nexport default OlimpusPlugin;\n"],
  "mappings": "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",
  "names": ["fs", "path", "fs", "path", "process", "path", "resolve", "process", "z", "z", "path", "path", "path", "existsSync", "dirname", "mkdirSync", "existsSync", "readFileSync", "dirname", "mkdirSync", "existsSync", "join"]
}
