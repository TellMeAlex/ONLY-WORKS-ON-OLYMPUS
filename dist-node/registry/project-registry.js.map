{
  "version": 3,
  "sources": ["../../src/registry/project-registry.ts"],
  "sourcesContent": ["import type {\n  ProjectConfig,\n  ProjectRegistryConfig,\n  SharedConfig,\n  PortfolioConfig,\n  OlimpusConfig,\n} from \"../config/schema.js\";\nimport type { AnalyticsStorage } from \"../analytics/storage.js\";\n\n/**\n * Registry for managing multiple project configurations with shared settings and overrides\n */\nexport class ProjectRegistry {\n  private projects: Map<string, ProjectConfig> = new Map();\n  private sharedConfig: SharedConfig | null = null;\n  private portfolioConfig: PortfolioConfig | null = null;\n  private registryConfig: ProjectRegistryConfig;\n  private analyticsStorage?: AnalyticsStorage;\n\n  constructor(\n    config?: ProjectRegistryConfig,\n    analyticsStorage?: AnalyticsStorage,\n  ) {\n    this.registryConfig = config ?? { projects: {} };\n    this.analyticsStorage = analyticsStorage;\n\n    // Initialize shared config if provided\n    if (config.shared_config) {\n      this.sharedConfig = config.shared_config;\n    }\n\n    // Initialize portfolio config if provided\n    if (config.portfolio) {\n      this.portfolioConfig = config.portfolio;\n    }\n\n    // Register all projects from initial config\n    for (const [projectId, projectConfig] of Object.entries(config.projects || {})) {\n      this.register(projectId, projectConfig);\n    }\n  }\n\n  /**\n   * Register a project configuration\n   */\n  register(projectId: string, config: ProjectConfig): void {\n    // Ensure project_id matches the key\n    const normalizedConfig: ProjectConfig = {\n      ...config,\n      project_id: projectId,\n    };\n    this.projects.set(projectId, normalizedConfig);\n  }\n\n  /**\n   * Get a project configuration by ID\n   * Returns null if project not found\n   */\n  get(projectId: string): ProjectConfig | null {\n    return this.projects.get(projectId) ?? null;\n  }\n\n  /**\n   * Get all registered project configurations\n   */\n  getAll(): Record<string, ProjectConfig> {\n    const result: Record<string, ProjectConfig> = {};\n    for (const [projectId, config] of this.projects.entries()) {\n      result[projectId] = config;\n    }\n    return result;\n  }\n\n  /**\n   * Check if a project is registered\n   */\n  has(projectId: string): boolean {\n    return this.projects.has(projectId);\n  }\n\n  /**\n   * Unregister a project\n   */\n  unregister(projectId: string): boolean {\n    return this.projects.delete(projectId);\n  }\n\n  /**\n   * Get merged configuration for a project\n   * Merges shared config with project-specific overrides\n   */\n  getMergedConfig(projectId: string): OlimpusConfig | null {\n    const project = this.projects.get(projectId);\n    if (!project) {\n      return null;\n    }\n\n    // Start with base config from shared config (if any)\n    const baseConfig = this.sharedConfig?.base_config ?? {};\n\n    // Merge project-specific overrides\n    const merged: OlimpusConfig = {\n      ...baseConfig,\n    };\n\n    // Apply project overrides if they exist\n    if (project.overrides) {\n      // Merge meta_agents (partial overrides)\n      if (project.overrides.meta_agents) {\n        merged.meta_agents = {\n          ...merged.meta_agents,\n          ...project.overrides.meta_agents,\n        } as typeof merged.meta_agents;\n      }\n\n      // Merge providers config\n      if (project.overrides.providers) {\n        merged.providers = {\n          ...merged.providers,\n          ...project.overrides.providers,\n        };\n      }\n\n      // Merge settings\n      if (project.overrides.settings) {\n        merged.settings = {\n          ...merged.settings,\n          ...project.overrides.settings,\n        };\n      }\n\n      // Merge agent overrides\n      if (project.overrides.agents) {\n        merged.agents = {\n          ...merged.agents,\n          ...project.overrides.agents,\n        };\n      }\n\n      // Merge categories\n      if (project.overrides.categories) {\n        merged.categories = {\n          ...merged.categories,\n          ...project.overrides.categories,\n        };\n      }\n\n      // Merge skills\n      if (project.overrides.skills) {\n        merged.skills = [\n          ...(merged.skills ?? []),\n          ...project.overrides.skills,\n        ];\n      }\n    }\n\n    return merged;\n  }\n\n  /**\n   * Get the shared configuration\n   */\n  getSharedConfig(): SharedConfig | null {\n    return this.sharedConfig;\n  }\n\n  /**\n   * Set the shared configuration\n   */\n  setSharedConfig(config: SharedConfig): void {\n    this.sharedConfig = config;\n  }\n\n  /**\n   * Get the portfolio configuration\n   */\n  getPortfolioConfig(): PortfolioConfig | null {\n    return this.portfolioConfig;\n  }\n\n  /**\n   * Set the portfolio configuration\n   */\n  setPortfolioConfig(config: PortfolioConfig): void {\n    this.portfolioConfig = config;\n  }\n\n  /**\n   * Get the default project ID from portfolio config\n   */\n  getDefaultProjectId(): string | null {\n    return this.portfolioConfig?.default_project_id ?? null;\n  }\n\n  /**\n   * Check if cross-project delegation is enabled\n   */\n  isCrossProjectDelegationEnabled(): boolean {\n    return this.portfolioConfig?.enable_cross_project_delegation ?? true;\n  }\n\n  /**\n   * Check if analytics aggregation is enabled\n   */\n  isAggregationEnabled(): boolean {\n    return this.portfolioConfig?.enable_aggregation ?? true;\n  }\n\n  /**\n   * Get the maximum cross-project delegation depth\n   */\n  getMaxCrossProjectDepth(): number {\n    return this.portfolioConfig?.max_cross_project_depth ?? 5;\n  }\n\n  /**\n   * Get the agent namespace format\n   */\n  getAgentNamespaceFormat(): string {\n    return this.portfolioConfig?.agent_namespace_format ?? \"{project_id}:{agent_name}\";\n  }\n\n  /**\n   * Format an agent name with project namespace\n   */\n  formatAgentName(projectId: string, agentName: string): string {\n    const format = this.getAgentNamespaceFormat();\n    return format\n      .replace(\"{project_id}\", projectId)\n      .replace(\"{agent_name}\", agentName);\n  }\n\n  /**\n   * Parse a namespaced agent name\n   * Returns { projectId, agentName } or null if not a valid namespaced name\n   */\n  parseAgentName(namespacedName: string): { projectId: string; agentName: string } | null {\n    const format = this.getAgentNamespaceFormat();\n    const projectIdVar = \"{project_id}\";\n    const agentNameVar = \"{agent_name}\";\n\n    // Check if the format matches the pattern\n    const parts = namespacedName.split(\":\");\n\n    // Simple case: \"project:agent\"\n    if (format === \"{project_id}:{agent_name}\" && parts.length === 2) {\n      return { projectId: parts[0], agentName: parts[1] };\n    }\n\n    // For other formats, try to infer based on registered projects\n    for (const [projectId] of this.projects.entries()) {\n      const prefix = format.replace(projectIdVar, projectId).replace(agentNameVar, \"\");\n      if (namespacedName.startsWith(prefix)) {\n        const agentName = namespacedName.slice(prefix.length);\n        return { projectId, agentName };\n      }\n    }\n\n    return null;\n  }\n\n  /**\n   * Get all projects with analytics enabled\n   */\n  getAnalyticsEnabledProjects(): ProjectConfig[] {\n    const result: ProjectConfig[] = [];\n    for (const config of this.projects.values()) {\n      if (config.analytics_enabled) {\n        result.push(config);\n      }\n    }\n    return result;\n  }\n\n  /**\n   * Get project metadata\n   */\n  getProjectMetadata(projectId: string): ProjectConfig[\"metadata\"] | null {\n    const project = this.projects.get(projectId);\n    return project?.metadata ?? null;\n  }\n\n  /**\n   * Get projects by tag\n   */\n  getProjectsByTag(tag: string): ProjectConfig[] {\n    const result: ProjectConfig[] = [];\n    for (const config of this.projects.values()) {\n      if (config.metadata?.tags?.includes(tag)) {\n        result.push(config);\n      }\n    }\n    return result;\n  }\n\n  /**\n   * Update a project configuration\n   */\n  update(projectId: string, updates: Partial<ProjectConfig>): boolean {\n    const existing = this.projects.get(projectId);\n    if (!existing) {\n      return false;\n    }\n\n    const updated: ProjectConfig = {\n      ...existing,\n      ...updates,\n      project_id: projectId, // Ensure project_id is preserved\n      overrides: {\n        ...existing.overrides,\n        ...(updates.overrides ?? {}),\n      },\n      metadata: {\n        ...existing.metadata,\n        ...(updates.metadata ?? {}),\n        updated_at: new Date().toISOString(),\n      },\n    };\n\n    this.projects.set(projectId, updated);\n    return true;\n  }\n\n  /**\n   * Get the count of registered projects\n   */\n  getProjectCount(): number {\n    return this.projects.size;\n  }\n}\n"],
  "mappings": "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",
  "names": []
}
